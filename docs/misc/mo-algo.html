
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>莫队算法 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="parallel-binsearch.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../intro/roadmap.html">
            
                <a href="../intro/roadmap.html">
            
                    
                    学习路线
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../intro/resources.html">
            
                <a href="../intro/resources.html">
            
                    
                    学习资源
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../intro/common-mistakes.html">
            
                <a href="../intro/common-mistakes.html">
            
                    
                    常见错误
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../intro/common-tricks.html">
            
                <a href="../intro/common-tricks.html">
            
                    
                    常见技巧
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../intro/oi.html">
            
                <a href="../intro/oi.html">
            
                    
                    OI赛事与赛制
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    [语言基础]
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../basic/">
            
                <a href="../basic/">
            
                    
                    算法基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../basic/enumerate.html">
            
                <a href="../basic/enumerate.html">
            
                    
                    枚举
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../basic/simulate.html">
            
                <a href="../basic/simulate.html">
            
                    
                    模拟
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../basic/divide-and-conquer.html">
            
                <a href="../basic/divide-and-conquer.html">
            
                    
                    递归&分治
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../basic/sort-intro.html">
            
                <a href="../basic/sort-intro.html">
            
                    
                    排序
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.4.1" data-path="../basic/selection-sort.html">
            
                <a href="../basic/selection-sort.html">
            
                    
                    选择排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.2" data-path="../basic/bubble-sort.html">
            
                <a href="../basic/bubble-sort.html">
            
                    
                    冒泡排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.3" data-path="../basic/insertion-sort.html">
            
                <a href="../basic/insertion-sort.html">
            
                    
                    插入排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.4" data-path="../basic/counting-sort.html">
            
                <a href="../basic/counting-sort.html">
            
                    
                    计数排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.5" data-path="../basic/radix-sort.html">
            
                <a href="../basic/radix-sort.html">
            
                    
                    基数排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.6" data-path="../basic/quick-sort.html">
            
                <a href="../basic/quick-sort.html">
            
                    
                    快速排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.7" data-path="../basic/merge-sort.html">
            
                <a href="../basic/merge-sort.html">
            
                    
                    归并排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.8" data-path="../basic/heap-sort.html">
            
                <a href="../basic/heap-sort.html">
            
                    
                    堆排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.9" data-path="../basic/bucket-sort.html">
            
                <a href="../basic/bucket-sort.html">
            
                    
                    桶排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.10" data-path="../basic/shell-sort.html">
            
                <a href="../basic/shell-sort.html">
            
                    
                    希尔排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.11" data-path="../basic/stl-sort.html">
            
                <a href="../basic/stl-sort.html">
            
                    
                    排序相关STL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4.12" data-path="../basic/use-of-sort.html">
            
                <a href="../basic/use-of-sort.html">
            
                    
                    排序应用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../basic/binary.html">
            
                <a href="../basic/binary.html">
            
                    
                    二分
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../basic/binary-acc.html">
            
                <a href="../basic/binary-acc.html">
            
                    
                    倍增
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../basic/construction.html">
            
                <a href="../basic/construction.html">
            
                    
                    构造
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../basic/prefix-sum.html">
            
                <a href="../basic/prefix-sum.html">
            
                    
                    前缀&差分
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../search/">
            
                <a href="../search/">
            
                    
                    搜索
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../search/dfs.html">
            
                <a href="../search/dfs.html">
            
                    
                    DFS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../search/bfs.html">
            
                <a href="../search/bfs.html">
            
                    
                    BFS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../search/bidirectional.html">
            
                <a href="../search/bidirectional.html">
            
                    
                    双向搜索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../search/heuristic.html">
            
                <a href="../search/heuristic.html">
            
                    
                    启发式搜索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../search/astar.html">
            
                <a href="../search/astar.html">
            
                    
                    A-star
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../search/iterative.html">
            
                <a href="../search/iterative.html">
            
                    
                    迭代加深搜索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../search/idastar.html">
            
                <a href="../search/idastar.html">
            
                    
                    IDA-star
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../search/backtracking.html">
            
                <a href="../search/backtracking.html">
            
                    
                    回溯
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../search/dlx.html">
            
                <a href="../search/dlx.html">
            
                    
                    Dancing Links
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../search/opt.html">
            
                <a href="../search/opt.html">
            
                    
                    优化
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../dp/">
            
                <a href="../dp/">
            
                    
                    动态规划
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../dp/memo.html">
            
                <a href="../dp/memo.html">
            
                    
                    记忆化搜索
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../dp/knapsack.html">
            
                <a href="../dp/knapsack.html">
            
                    
                    背包DP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../dp/interval.html">
            
                <a href="../dp/interval.html">
            
                    
                    区间DP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../dp/dag.html">
            
                <a href="../dp/dag.html">
            
                    
                    DAG上的DP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../dp/tree.html">
            
                <a href="../dp/tree.html">
            
                    
                    树形DP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../dp/state.html">
            
                <a href="../dp/state.html">
            
                    
                    状压DP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../dp/number.html">
            
                <a href="../dp/number.html">
            
                    
                    数位DP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../dp/plug.html">
            
                <a href="../dp/plug.html">
            
                    
                    插头DP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../dp/count.html">
            
                <a href="../dp/count.html">
            
                    
                    计数DP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../dp/dynamic.html">
            
                <a href="../dp/dynamic.html">
            
                    
                    动态DP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" >
            
                <span>
            
                    
                    [DP优化]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.11.1" data-path="../dp/opt/binary-knapsack.html">
            
                <a href="../dp/opt/binary-knapsack.html">
            
                    
                    二进制分组解多重背包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11.2" data-path="../dp/opt/monotonous-queue-stack.html">
            
                <a href="../dp/opt/monotonous-queue-stack.html">
            
                    
                    单调队列/单调栈优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11.3" data-path="../dp/opt/slope.html">
            
                <a href="../dp/opt/slope.html">
            
                    
                    斜率优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11.4" data-path="../dp/opt/quadrangle.html">
            
                <a href="../dp/opt/quadrangle.html">
            
                    
                    四边形不等式优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11.5" data-path="../dp/opt/state.html">
            
                <a href="../dp/opt/state.html">
            
                    
                    状态设计优化
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../string/">
            
                <a href="../string/">
            
                    
                    字符串
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../string/match.html">
            
                <a href="../string/match.html">
            
                    
                    字符串匹配
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../string/hash.html">
            
                <a href="../string/hash.html">
            
                    
                    字符串哈希
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../string/trie.html">
            
                <a href="../string/trie.html">
            
                    
                    字典树Trie
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../string/kmp.html">
            
                <a href="../string/kmp.html">
            
                    
                    前缀函数&KMP算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../string/z-func.html">
            
                <a href="../string/z-func.html">
            
                    
                    Z函数(扩展KMP)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../string/automaton.html">
            
                <a href="../string/automaton.html">
            
                    
                    自动机
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../string/ac-automaton.html">
            
                <a href="../string/ac-automaton.html">
            
                    
                    AC自动机
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../string/sa.html">
            
                <a href="../string/sa.html">
            
                    
                    后缀数组(SA)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="../string/sam.html">
            
                <a href="../string/sam.html">
            
                    
                    后缀自动机(SAM)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../string/general-sam.html">
            
                <a href="../string/general-sam.html">
            
                    
                    广义后缀自动机
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11" data-path="../string/suffix-tree.html">
            
                <a href="../string/suffix-tree.html">
            
                    
                    后缀树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12" data-path="../string/manacher.html">
            
                <a href="../string/manacher.html">
            
                    
                    Manacher
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.13" data-path="../string/pam.html">
            
                <a href="../string/pam.html">
            
                    
                    回文自动机
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.14" data-path="../string/seq-automaton.html">
            
                <a href="../string/seq-automaton.html">
            
                    
                    序列自动机
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15" data-path="../string/minimal-string.html">
            
                <a href="../string/minimal-string.html">
            
                    
                    最小表示法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.16" data-path="../string/lyndon.html">
            
                <a href="../string/lyndon.html">
            
                    
                    Lyndon分解
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../math/">
            
                <a href="../math/">
            
                    
                    数学
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" >
            
                <span>
            
                    
                    [基础知识]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1" data-path="../math/vector.html">
            
                <a href="../math/vector.html">
            
                    
                    向量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.2" data-path="../math/complex.html">
            
                <a href="../math/complex.html">
            
                    
                    复数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.3" data-path="../math/polar-coordinate.html">
            
                <a href="../math/polar-coordinate.html">
            
                    
                    极坐标系
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.4" data-path="../math/bit.html">
            
                <a href="../math/bit.html">
            
                    
                    位运算
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.5" data-path="../math/quick-pow.html">
            
                <a href="../math/quick-pow.html">
            
                    
                    快速幂
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2" >
            
                <span>
            
                    
                    [数论]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.1" data-path="../math/prime.html">
            
                <a href="../math/prime.html">
            
                    
                    素数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2" data-path="../math/gcd.html">
            
                <a href="../math/gcd.html">
            
                    
                    最大公约数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.3" data-path="../math/euler.html">
            
                <a href="../math/euler.html">
            
                    
                    欧拉函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.4" data-path="../math/sieve.html">
            
                <a href="../math/sieve.html">
            
                    
                    筛法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.5" data-path="../math/fermat.html">
            
                <a href="../math/fermat.html">
            
                    
                    欧拉定理&费马小定理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.6" data-path="../math/euclidean.html">
            
                <a href="../math/euclidean.html">
            
                    
                    类欧几里得算法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.3" >
            
                <span>
            
                    
                    [同余与同余方程]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.3.1" data-path="../math/bezouts.html">
            
                <a href="../math/bezouts.html">
            
                    
                    裴属定理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.2" data-path="../math/inverse.html">
            
                <a href="../math/inverse.html">
            
                    
                    乘法逆元
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.3" data-path="../math/linear-equation.html">
            
                <a href="../math/linear-equation.html">
            
                    
                    线性同余方程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.4" data-path="../math/crt.html">
            
                <a href="../math/crt.html">
            
                    
                    中国剩余定理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.5" data-path="../math/bsgs.html">
            
                <a href="../math/bsgs.html">
            
                    
                    BSGS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.6" data-path="../math/primitive-root.html">
            
                <a href="../math/primitive-root.html">
            
                    
                    原根
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3.7" data-path="../math/lucas.html">
            
                <a href="../math/lucas.html">
            
                    
                    卢卡斯定理
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../math/base.html">
            
                <a href="../math/base.html">
            
                    
                    进位制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" >
            
                <span>
            
                    
                    [数论函数]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.5.1" data-path="../math/mobius.html">
            
                <a href="../math/mobius.html">
            
                    
                    莫比乌斯反演
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.2" data-path="../math/du.html">
            
                <a href="../math/du.html">
            
                    
                    杜教筛
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.3" data-path="../math/min-25.html">
            
                <a href="../math/min-25.html">
            
                    
                    Min-25筛
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../math/poly/intro.html">
            
                <a href="../math/poly/intro.html">
            
                    
                    多项式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.6.1" data-path="../math/poly/lagrange.html">
            
                <a href="../math/poly/lagrange.html">
            
                    
                    拉格朗日插值
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6.2" data-path="../math/poly/fft.html">
            
                <a href="../math/poly/fft.html">
            
                    
                    快速傅里叶变换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6.3" data-path="../math/poly/ntt.html">
            
                <a href="../math/poly/ntt.html">
            
                    
                    快速数论变换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6.4" data-path="../math/poly/fwt.html">
            
                <a href="../math/poly/fwt.html">
            
                    
                    快速沃尔什变换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6.5" data-path="../math/poly/inv.html">
            
                <a href="../math/poly/inv.html">
            
                    
                    多项式求逆
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6.6" data-path="../math/poly/sqrt.html">
            
                <a href="../math/poly/sqrt.html">
            
                    
                    多项式开方
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6.7" data-path="../math/poly/div-mod.html">
            
                <a href="../math/poly/div-mod.html">
            
                    
                    多项式对数函数&指数函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6.8" data-path="../math/poly/ln-exp.html">
            
                <a href="../math/poly/ln-exp.html">
            
                    
                    多项式牛顿迭代
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6.9" data-path="../math/poly/newton.html">
            
                <a href="../math/poly/newton.html">
            
                    
                    多项式多点求值&快速插值
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6.10" data-path="../math/poly/tri-func.html">
            
                <a href="../math/poly/tri-func.html">
            
                    
                    多项式三角函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6.11" data-path="../math/poly/inv-tri-func.html">
            
                <a href="../math/poly/inv-tri-func.html">
            
                    
                    多项式反三角函数
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.7" >
            
                <span>
            
                    
                    [线性代数]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.7.1" data-path="../math/matrix.html">
            
                <a href="../math/matrix.html">
            
                    
                    矩阵
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7.2" data-path="../math/gauss.html">
            
                <a href="../math/gauss.html">
            
                    
                    高斯消元
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7.3" data-path="../math/basis.html">
            
                <a href="../math/basis.html">
            
                    
                    线性基
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.8" >
            
                <span>
            
                    
                    [抽象代数]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.8.1" data-path="../math/permutation-group.html">
            
                <a href="../math/permutation-group.html">
            
                    
                    置换群
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.9" >
            
                <span>
            
                    
                    [组合数学]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.9.1" data-path="../math/combination.html">
            
                <a href="../math/combination.html">
            
                    
                    排列组合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.9.2" data-path="../math/catalan.html">
            
                <a href="../math/catalan.html">
            
                    
                    卡特兰数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.9.3" data-path="../math/stirling.html">
            
                <a href="../math/stirling.html">
            
                    
                    斯特林数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.9.4" data-path="../math/cantor.html">
            
                <a href="../math/cantor.html">
            
                    
                    康托展开
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.9.5" data-path="../math/inclusion-exclusion-principle.html">
            
                <a href="../math/inclusion-exclusion-principle.html">
            
                    
                    容斥原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.9.6" data-path="../math/drawer-principle.html">
            
                <a href="../math/drawer-principle.html">
            
                    
                    抽屉原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.9.7" data-path="../math/expectation.html">
            
                <a href="../math/expectation.html">
            
                    
                    概率&期望
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.10" data-path="../math/linear-programming.html">
            
                <a href="../math/linear-programming.html">
            
                    
                    线性规划
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.10.1" data-path="../math/simplex.html">
            
                <a href="../math/simplex.html">
            
                    
                    单纯形算法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.11" data-path="../math/game-theory.html">
            
                <a href="../math/game-theory.html">
            
                    
                    博弈论
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.12" >
            
                <span>
            
                    
                    [常用算法]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.12.1" data-path="../math/newton.html">
            
                <a href="../math/newton.html">
            
                    
                    牛顿迭代法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.12.2" data-path="../math/integral.html">
            
                <a href="../math/integral.html">
            
                    
                    数值积分
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.12.3" data-path="../math/bignum.html">
            
                <a href="../math/bignum.html">
            
                    
                    高精度计算
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.12.4" data-path="../math/dictionary.html">
            
                <a href="../math/dictionary.html">
            
                    
                    分段打表
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.13" data-path="../math/fibonacci.html">
            
                <a href="../math/fibonacci.html">
            
                    
                    斐波那契数列
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../ds/">
            
                <a href="../ds/">
            
                    
                    数据结构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../ds/stack.html">
            
                <a href="../ds/stack.html">
            
                    
                    栈
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../ds/queue.html">
            
                <a href="../ds/queue.html">
            
                    
                    队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../ds/linked-list.html">
            
                <a href="../ds/linked-list.html">
            
                    
                    链表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../ds/hash.html">
            
                <a href="../ds/hash.html">
            
                    
                    哈希表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../ds/dsu.html">
            
                <a href="../ds/dsu.html">
            
                    
                    并查集
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../ds/heap.html">
            
                <a href="../ds/heap.html">
            
                    
                    堆
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.6.1" data-path="../ds/binary-heap.html">
            
                <a href="../ds/binary-heap.html">
            
                    
                    二叉堆
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6.2" data-path="../ds/pairing-heap.html">
            
                <a href="../ds/pairing-heap.html">
            
                    
                    配对堆
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6.3" data-path="../ds/leftist-tree.html">
            
                <a href="../ds/leftist-tree.html">
            
                    
                    左偏树
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.7" >
            
                <span>
            
                    
                    [块状数据结构]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.7.1" data-path="../ds/decompose.html">
            
                <a href="../ds/decompose.html">
            
                    
                    分块思想
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7.2" data-path="../ds/tree-decompose.html">
            
                <a href="../ds/tree-decompose.html">
            
                    
                    树分块
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7.3" data-path="../ds/block-list.html">
            
                <a href="../ds/block-list.html">
            
                    
                    块状链表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7.4" data-path="../ds/block-array.html">
            
                <a href="../ds/block-array.html">
            
                    
                    块状数组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7.5" data-path="../ds/sqrt-tree.html">
            
                <a href="../ds/sqrt-tree.html">
            
                    
                    sqrt tree
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../ds/monotonous-stack.html">
            
                <a href="../ds/monotonous-stack.html">
            
                    
                    单调栈
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="../ds/monotonous-queue.html">
            
                <a href="../ds/monotonous-queue.html">
            
                    
                    单调队列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.10" data-path="../ds/sparse-table.html">
            
                <a href="../ds/sparse-table.html">
            
                    
                    ST表
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.11" data-path="../ds/bit.html">
            
                <a href="../ds/bit.html">
            
                    
                    树状数组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.12" data-path="../ds/seg.html">
            
                <a href="../ds/seg.html">
            
                    
                    线段树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.13" data-path="../ds/seg-beats.html">
            
                <a href="../ds/seg-beats.html">
            
                    
                    区间最值操作&区间历史最值
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.14" data-path="../ds/dividing.html">
            
                <a href="../ds/dividing.html">
            
                    
                    划分树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15" data-path="../ds/bst.html">
            
                <a href="../ds/bst.html">
            
                    
                    二叉搜索树&平衡树
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.15.1" data-path="../ds/treap.html">
            
                <a href="../ds/treap.html">
            
                    
                    Treap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15.2" data-path="../ds/splay.html">
            
                <a href="../ds/splay.html">
            
                    
                    Splay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15.3" data-path="../ds/wblt.html">
            
                <a href="../ds/wblt.html">
            
                    
                    WBLT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15.4" data-path="../ds/sbt.html">
            
                <a href="../ds/sbt.html">
            
                    
                    Size Balanced Tree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15.5" data-path="../ds/avl.html">
            
                <a href="../ds/avl.html">
            
                    
                    AVL树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15.6" data-path="../ds/sgt.html">
            
                <a href="../ds/sgt.html">
            
                    
                    替罪羊树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15.7" data-path="../ds/cartesian-tree.html">
            
                <a href="../ds/cartesian-tree.html">
            
                    
                    笛卡尔树
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.16" data-path="../ds/persistent.html">
            
                <a href="../ds/persistent.html">
            
                    
                    可持久化数据结构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.16.1" data-path="../ds/persistent-seg.html">
            
                <a href="../ds/persistent-seg.html">
            
                    
                    可持久化线段树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.16.2" data-path="../ds/persistent-block-array.html">
            
                <a href="../ds/persistent-block-array.html">
            
                    
                    可持久化块状数组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.16.3" data-path="../ds/persistent-balanced.html">
            
                <a href="../ds/persistent-balanced.html">
            
                    
                    可持久化平衡树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.16.4" data-path="../ds/persistent-trie.html">
            
                <a href="../ds/persistent-trie.html">
            
                    
                    可持久化字典树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.16.5" data-path="../ds/persistent-in-bit.html">
            
                <a href="../ds/persistent-in-bit.html">
            
                    
                    可持久化可并堆
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.16.6" data-path="../ds/persistent-heap.html">
            
                <a href="../ds/persistent-heap.html">
            
                    
                    可持久化左偏树
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.17" >
            
                <span>
            
                    
                    [树套树]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.17.1" data-path="../ds/seg-in-seg.html">
            
                <a href="../ds/seg-in-seg.html">
            
                    
                    线段树套线段树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.17.2" data-path="../ds/seg-in-balanced.html">
            
                <a href="../ds/seg-in-balanced.html">
            
                    
                    平衡树套线段树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.17.3" data-path="../ds/balanced-in-seg.html">
            
                <a href="../ds/balanced-in-seg.html">
            
                    
                    线段树套平衡树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.17.4" data-path="../ds/persistent-in-bit.html">
            
                <a href="../ds/persistent-in-bit.html">
            
                    
                    树状数组套主席树
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.18" data-path="../ds/kdt.html">
            
                <a href="../ds/kdt.html">
            
                    
                    K-D Tree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.19" data-path="../ds/odt.html">
            
                <a href="../ds/odt.html">
            
                    
                    珂朵莉树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.20" >
            
                <span>
            
                    
                    [动态树]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.20.1" data-path="../ds/lct.html">
            
                <a href="../ds/lct.html">
            
                    
                    Link Cut Tree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.20.2" data-path="../ds/ett.html">
            
                <a href="../ds/ett.html">
            
                    
                    Euler Tour Tree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.20.3" data-path="../ds/top-tree.html">
            
                <a href="../ds/top-tree.html">
            
                    
                    Top Tree
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.21" data-path="../ds/divide-combine.html">
            
                <a href="../ds/divide-combine.html">
            
                    
                    析合树
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../graph/">
            
                <a href="../graph/">
            
                    
                    图论
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../graph/basic.html">
            
                <a href="../graph/basic.html">
            
                    
                    图论基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../graph/dfs.html">
            
                <a href="../graph/dfs.html">
            
                    
                    DFS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../graph/bfs.html">
            
                <a href="../graph/bfs.html">
            
                    
                    BFS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" >
            
                <span>
            
                    
                    [树上问题]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.4.1" data-path="../graph/tree-basic.html">
            
                <a href="../graph/tree-basic.html">
            
                    
                    树基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.2" data-path="../graph/lca.html">
            
                <a href="../graph/lca.html">
            
                    
                    最近公共祖先
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.3" data-path="../graph/tree-misc.html">
            
                <a href="../graph/tree-misc.html">
            
                    
                    树的其他问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.4" data-path="../graph/tree-hash.html">
            
                <a href="../graph/tree-hash.html">
            
                    
                    树哈希
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.5" data-path="../graph/hld.html">
            
                <a href="../graph/hld.html">
            
                    
                    树链剖分
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.6" data-path="../graph/tree-divide.html">
            
                <a href="../graph/tree-divide.html">
            
                    
                    树分治
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.7" data-path="../graph/dynamic-tree-divide.html">
            
                <a href="../graph/dynamic-tree-divide.html">
            
                    
                    动态树分治
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.8" data-path="../graph/virtual-tree.html">
            
                <a href="../graph/virtual-tree.html">
            
                    
                    虚树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.9" data-path="../graph/dsu-on-tree.html">
            
                <a href="../graph/dsu-on-tree.html">
            
                    
                    树上启发式合并
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../graph/matrix-tree.html">
            
                <a href="../graph/matrix-tree.html">
            
                    
                    矩阵树定理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.6" data-path="../graph/dag.html">
            
                <a href="../graph/dag.html">
            
                    
                    有向无环图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.7" data-path="../graph/topo.html">
            
                <a href="../graph/topo.html">
            
                    
                    拓扑排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.8" data-path="../graph/mst.html">
            
                <a href="../graph/mst.html">
            
                    
                    最小生成树
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.9" data-path="../graph/mdst.html">
            
                <a href="../graph/mdst.html">
            
                    
                    最小树形图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.10" data-path="../graph/shortest-path.html">
            
                <a href="../graph/shortest-path.html">
            
                    
                    最短路
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.11" data-path="../graph/node.html">
            
                <a href="../graph/node.html">
            
                    
                    拆点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.12" data-path="../graph/diff-constraints.html">
            
                <a href="../graph/diff-constraints.html">
            
                    
                    差分约束
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.13" data-path="../graph/kth-path.html">
            
                <a href="../graph/kth-path.html">
            
                    
                    k短路
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.14" >
            
                <span>
            
                    
                    [连通性相关]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.14.1" data-path="../graph/scc.html">
            
                <a href="../graph/scc.html">
            
                    
                    强连通分量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.14.2" data-path="../graph/bcc.html">
            
                <a href="../graph/bcc.html">
            
                    
                    双联通分量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.14.3" data-path="../graph/bridge.html">
            
                <a href="../graph/bridge.html">
            
                    
                    割点和桥
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.14.4" data-path="../graph/2-sat.html">
            
                <a href="../graph/2-sat.html">
            
                    
                    2-SAT
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.15" data-path="../graph/euler.html">
            
                <a href="../graph/euler.html">
            
                    
                    欧拉图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.16" data-path="../graph/hamilton.html">
            
                <a href="../graph/hamilton.html">
            
                    
                    哈密顿图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.17" data-path="../graph/bi-graph.html">
            
                <a href="../graph/bi-graph.html">
            
                    
                    二分图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.18" data-path="../graph/min-circle.html">
            
                <a href="../graph/min-circle.html">
            
                    
                    最小环
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.19" data-path="../graph/planar.html">
            
                <a href="../graph/planar.html">
            
                    
                    平面图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.20" data-path="../graph/color.html">
            
                <a href="../graph/color.html">
            
                    
                    图的着色
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.21" data-path="../graph/flow.html">
            
                <a href="../graph/flow.html">
            
                    
                    网络流
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.21.1" data-path="../graph/flow/max-flow.html">
            
                <a href="../graph/flow/max-flow.html">
            
                    
                    最大流
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.21.2" data-path="../graph/flow/min-cut.html">
            
                <a href="../graph/flow/min-cut.html">
            
                    
                    最小割
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.21.3" data-path="../graph/flow/min-cost.html">
            
                <a href="../graph/flow/min-cost.html">
            
                    
                    费用流
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.21.4" data-path="../graph/flow/bound.html">
            
                <a href="../graph/flow/bound.html">
            
                    
                    上下界网络流
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.22" data-path="../graph/prufer.html">
            
                <a href="../graph/prufer.html">
            
                    
                    Prufer序列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.23" data-path="../graph/lgv.html">
            
                <a href="../graph/lgv.html">
            
                    
                    LGV引理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.24" data-path="../graph/misc.html">
            
                <a href="../graph/misc.html">
            
                    
                    图论杂项
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../geometry/">
            
                <a href="../geometry/">
            
                    
                    计算几何
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../geometry/2d.html">
            
                <a href="../geometry/2d.html">
            
                    
                    二维计算几何
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../geometry/3d.html">
            
                <a href="../geometry/3d.html">
            
                    
                    三维计算几何
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../geometry/distance.html">
            
                <a href="../geometry/distance.html">
            
                    
                    距离
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="../geometry/pick.html">
            
                <a href="../geometry/pick.html">
            
                    
                    Pick定理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5" data-path="../geometry/triangulation.html">
            
                <a href="../geometry/triangulation.html">
            
                    
                    三角剖分
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.6" data-path="../geometry/convex-hull.html">
            
                <a href="../geometry/convex-hull.html">
            
                    
                    凸包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.7" data-path="../geometry/scanning.html">
            
                <a href="../geometry/scanning.html">
            
                    
                    扫描线
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.8" data-path="../geometry/rotating-calipers.html">
            
                <a href="../geometry/rotating-calipers.html">
            
                    
                    旋转卡壳
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.9" data-path="../geometry/half-plane.html">
            
                <a href="../geometry/half-plane.html">
            
                    
                    半平面交
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.10" data-path="../geometry/nearest-points.html">
            
                <a href="../geometry/nearest-points.html">
            
                    
                    平面最近点对
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.11" data-path="../geometry/random-incremental.html">
            
                <a href="../geometry/random-incremental.html">
            
                    
                    随机增量法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.12" data-path="../geometry/inverse.html">
            
                <a href="../geometry/inverse.html">
            
                    
                    反演变换
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.13" data-path="../geometry/misc.html">
            
                <a href="../geometry/misc.html">
            
                    
                    计算几何杂项
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="./">
            
                <a href="./">
            
                    
                    杂项
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="discrete.html">
            
                <a href="discrete.html">
            
                    
                    离散化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="offline.html">
            
                <a href="offline.html">
            
                    
                    离线算法
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.2.1" data-path="cdq-divide.html">
            
                <a href="cdq-divide.html">
            
                    
                    CDQ分治
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2.2" data-path="parallel-binsearch.html">
            
                <a href="parallel-binsearch.html">
            
                    
                    整体二分
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.12.2.3" data-path="mo-algo.html">
            
                <a href="mo-algo.html">
            
                    
                    莫队算法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12.3" >
            
                <span>
            
                    
                    [随机化]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.3.1" data-path="random.html">
            
                <a href="random.html">
            
                    
                    随机函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3.2" data-path="hill-climbing.html">
            
                <a href="hill-climbing.html">
            
                    
                    爬山算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3.3" data-path="simulated-annealing.html">
            
                <a href="simulated-annealing.html">
            
                    
                    模拟退火
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="largest-matrix.html">
            
                <a href="largest-matrix.html">
            
                    
                    悬线法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="cc-basic.html">
            
                <a href="cc-basic.html">
            
                    
                    计算理论基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="josephus.html">
            
                <a href="josephus.html">
            
                    
                    约瑟夫问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="expression.html">
            
                <a href="expression.html">
            
                    
                    表达式求值
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" >
            
                <span>
            
                    
                    [专题]
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../topic/rmq.html">
            
                <a href="../topic/rmq.html">
            
                    
                    RMQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../topic/problemsetting.html">
            
                <a href="../topic/problemsetting.html">
            
                    
                    出题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >莫队算法</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>author: greyqz</p>
<h2 id="&#x666E;&#x901A;&#x83AB;&#x961F;&#x7B97;&#x6CD5;">&#x666E;&#x901A;&#x83AB;&#x961F;&#x7B97;&#x6CD5;</h2>
<h3 id="&#x6982;&#x8FF0;">&#x6982;&#x8FF0;</h3>
<p>&#x83AB;&#x961F;&#x7B97;&#x6CD5;&#x662F;&#x7531;&#x83AB;&#x6D9B;&#x63D0;&#x51FA;&#x7684;&#x7B97;&#x6CD5;&#xFF0C;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x4E00;&#x7C7B;&#x79BB;&#x7EBF;&#x533A;&#x95F4;&#x8BE2;&#x95EE;&#x95EE;&#x9898;&#xFF0C;&#x9002;&#x7528;&#x6027;&#x6781;&#x4E3A;&#x5E7F;&#x6CDB;&#x3002;&#x540C;&#x65F6;&#x5C06;&#x5176;&#x52A0;&#x4EE5;&#x6269;&#x5C55;&#xFF0C;&#x4FBF;&#x80FD;&#x8F7B;&#x677E;&#x5904;&#x7406;&#x6811;&#x4E0A;&#x8DEF;&#x5F84;&#x8BE2;&#x95EE;&#x4EE5;&#x53CA;&#x652F;&#x6301;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;&#x3002;</p>
<h3 id="&#x5F62;&#x5F0F;">&#x5F62;&#x5F0F;</h3>
<p>&#x5047;&#x8BBE; $n=m$ &#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x4E8E;&#x5E8F;&#x5217;&#x4E0A;&#x7684;&#x533A;&#x95F4;&#x8BE2;&#x95EE;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x679C;&#x4ECE; $[l,r]$ &#x7684;&#x7B54;&#x6848;&#x80FD;&#x591F; $O(1)$ &#x6269;&#x5C55;&#x5230; $[l-1,r],[l+1,r],[l,r+1],[l,r-1]$ &#xFF08;&#x5373;&#x4E0E; $[l,r]$ &#x76F8;&#x90BB;&#x7684;&#x533A;&#x95F4;&#xFF09;&#x7684;&#x7B54;&#x6848;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5728; $O(n\sqrt{n})$ &#x7684;&#x590D;&#x6742;&#x5EA6;&#x5185;&#x6C42;&#x51FA;&#x6240;&#x6709;&#x8BE2;&#x95EE;&#x7684;&#x7B54;&#x6848;&#x3002;</p>
<h3 id="&#x5B9E;&#x73B0;">&#x5B9E;&#x73B0;</h3>
<p>&#x79BB;&#x7EBF;&#x540E;&#x6392;&#x5E8F;&#xFF0C;&#x987A;&#x5E8F;&#x5904;&#x7406;&#x6BCF;&#x4E2A;&#x8BE2;&#x95EE;&#xFF0C;&#x66B4;&#x529B;&#x4ECE;&#x4E0A;&#x4E00;&#x4E2A;&#x533A;&#x95F4;&#x7684;&#x7B54;&#x6848;&#x8F6C;&#x79FB;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;&#x533A;&#x95F4;&#x7B54;&#x6848;&#xFF08;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x79FB;&#x52A8;&#x5373;&#x53EF;&#xFF09;&#x3002;</p>
<h3 id="&#x6392;&#x5E8F;&#x65B9;&#x6CD5;">&#x6392;&#x5E8F;&#x65B9;&#x6CD5;</h3>
<p>&#x5BF9;&#x4E8E;&#x533A;&#x95F4; $[l,r]$ , &#x4EE5; $l$ &#x6240;&#x5728;&#x5757;&#x7684;&#x7F16;&#x53F7;&#x4E3A;&#x7B2C;&#x4E00;&#x5173;&#x952E;&#x5B57;&#xFF0C; $r$ &#x4E3A;&#x7B2C;&#x4E8C;&#x5173;&#x952E;&#x5B57;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x6392;&#x5E8F;&#x3002;</p>
<h3 id="&#x6A21;&#x677F;">&#x6A21;&#x677F;</h3>
<pre><code class="lang-cpp"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">move</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pos, <span class="hljs-keyword">int</span> sign)</span> </span>{
  <span class="hljs-comment">// update nowAns</span>
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">solve</span><span class="hljs-params">()</span> </span>{
  BLOCK_SIZE = <span class="hljs-keyword">int</span>(<span class="hljs-built_in">ceil</span>(<span class="hljs-built_in">pow</span>(n, <span class="hljs-number">0.5</span>)));
  sort(querys, querys + m);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; ++i) {
    <span class="hljs-keyword">const</span> query &amp;q = querys[i];
    <span class="hljs-keyword">while</span> (l &gt; q.l) move(--l, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">while</span> (r &lt; q.r) move(r++, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">while</span> (l &lt; q.l) move(l++, <span class="hljs-number">-1</span>);
    <span class="hljs-keyword">while</span> (r &gt; q.r) move(--r, <span class="hljs-number">-1</span>);
    ans[q.id] = nowAns;
  }
}
</code></pre>
<h3 id="&#x590D;&#x6742;&#x5EA6;&#x5206;&#x6790;">&#x590D;&#x6742;&#x5EA6;&#x5206;&#x6790;</h3>
<p>&#x4EE5;&#x4E0B;&#x7684;&#x60C5;&#x51B5;&#x5728; $n$ &#x548C; $m$ &#x540C;&#x9636;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x8BA8;&#x8BBA;&#x3002;</p>
<p>&#x9996;&#x5148;&#x662F;&#x5206;&#x5757;&#x8FD9;&#x4E00;&#x6B65;&#xFF0C;&#x8FD9;&#x4E00;&#x6B65;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x6BEB;&#x65E0;&#x7591;&#x95EE;&#x5730;&#x662F; $O(\sqrt{n}\cdot\sqrt{n}\log\sqrt{n}+n\log n)=O(n\log n)$ ;</p>
<p>&#x63A5;&#x7740;&#x5C31;&#x5230;&#x4E86;&#x83AB;&#x961F;&#x7B97;&#x6CD5;&#x7684;&#x7CBE;&#x9AD3;&#x4E86;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x7528;&#x901A;&#x4FD7;&#x6613;&#x61C2;&#x7684;&#x521D;&#x4E2D;&#x65B9;&#x6CD5;&#x6765;&#x8BC1;&#x660E;&#x5B83;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x662F; $O(n\sqrt{n})$ &#xFF1B;</p>
<p>&#x8BC1;&#xFF1A;&#x4EE4;&#x6BCF;&#x4E00;&#x5757;&#x4E2D; $L$ &#x7684;&#x6700;&#x5927;&#x503C;&#x4E3A; $\max<em>1,\max_2,\max_3, \cdots , \max</em>{\lceil\sqrt{n}\rceil}$ &#x3002;</p>
<p>&#x7531;&#x7B2C;&#x4E00;&#x6B21;&#x6392;&#x5E8F;&#x53EF;&#x77E5;&#xFF0C; $\max<em>1 \le \max_2 \le \cdots \le \max</em>{\lceil\sqrt{n}\rceil}$ &#x3002;</p>
<p>&#x663E;&#x7136;&#xFF0C;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x5757;&#x66B4;&#x529B;&#x6C42;&#x51FA;&#x7B2C;&#x4E00;&#x4E2A;&#x8BE2;&#x95EE;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A; $O(n)$ &#x3002;</p>
<p>&#x8003;&#x8651;&#x6700;&#x574F;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5728;&#x6BCF;&#x4E00;&#x5757;&#x4E2D;&#xFF0C; $R$ &#x7684;&#x6700;&#x5927;&#x503C;&#x5747;&#x4E3A; $n$ &#xFF0C;&#x6BCF;&#x6B21;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;&#x5747;&#x8981;&#x5C06; $L$ &#x7531; $\max<em>{i - 1}$ &#x4FEE;&#x6539;&#x81F3; $\max_i$ &#x6216;&#x7531; $\max_i$ &#x4FEE;&#x6539;&#x81F3; $\max</em>{i - 1}$ &#x3002;</p>
<p>&#x8003;&#x8651; $R$ &#xFF1A;&#x56E0;&#x4E3A; $R$ &#x5728;&#x5757;&#x4E2D;&#x5DF2;&#x7ECF;&#x6392;&#x597D;&#x5E8F;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x540C;&#x4E00;&#x5757;&#x4FEE;&#x6539;&#x5B8C;&#x5B83;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A; $O(n)$ &#x3002;&#x5BF9;&#x4E8E;&#x6240;&#x6709;&#x5757;&#x5C31;&#x662F; $O(n\sqrt{n})$ &#x3002;</p>
<p>&#x91CD;&#x70B9;&#x5206;&#x6790; $L$ &#xFF1A;&#x56E0;&#x4E3A;&#x6BCF;&#x4E00;&#x6B21;&#x6539;&#x53D8;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x90FD;&#x662F; $O(\max<em>i-\max</em>{i-1})$ &#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x540C;&#x4E00;&#x5757;&#x4E2D;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A; $O(\sqrt{n}\cdot(\max<em>i-\max</em>{i-1}))$ &#x3002;</p>
<p>&#x5C06;&#x6BCF;&#x4E00;&#x5757; $L$ &#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#xFF1A;</p>
<p>&#x5BF9;&#x4E8E; $L$ &#x7684;&#x603B;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;</p>
<p>$$
\begin{aligned}
&amp; O(\sqrt{n}(\max{}<em>1-1)+\sqrt{n}(\max{}_2-\max{}_1)+\sqrt{n}(\max{}_3-\max{}_2)+\cdots+\sqrt{n}(\max{}</em>{\lceil\sqrt{n}\rceil}-\max{}<em>{\lceil\sqrt{n}\rceil-1))} \
= &amp; O(\sqrt{n}\cdot(\max{}_1-1+\max{}_2-\max{}_1+\max{}_3-\max{}_2+\cdots+\max{}</em>{\lceil\sqrt{n}\rceil-1}-\max{}<em>{\lceil\sqrt{n}\rceil-2}+\max{}</em>{\lceil\sqrt{n}\rceil}-\max{}<em>{\lceil\sqrt{n}\rceil-1)}) \
= &amp; O(\sqrt{n}\cdot(\max{}</em>{\lceil\sqrt{n}\rceil-1}))\
\end{aligned}</p>
<p>$$</p>
<p>&#xFF08;&#x88C2;&#x9879;&#x6C42;&#x548C;&#xFF09;</p>
<p>&#x7531;&#x9898;&#x53EF;&#x77E5; $\max_{\lceil\sqrt{n}\rceil}$ &#x6700;&#x5927;&#x4E3A; $n$ &#xFF0C;&#x6240;&#x4EE5; $L$ &#x7684;&#x603B;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x6700;&#x574F;&#x60C5;&#x51B5;&#x4E0B;&#x4E3A; $O(n\sqrt{n})$ &#x3002;</p>
<p>&#x7EFC;&#x4E0A;&#x6240;&#x8FF0;&#xFF0C;&#x83AB;&#x961F;&#x7B97;&#x6CD5;&#x7684;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A; $O(n\sqrt{n})$ &#xFF1B;</p>
<p>&#x4F46;&#x662F;&#x5BF9;&#x4E8E; $m$ &#x7684;&#x5176;&#x4ED6;&#x53D6;&#x503C;&#xFF0C;&#x5982; $m&lt;n$ &#xFF0C;&#x5206;&#x5757;&#x65B9;&#x5F0F;&#x9700;&#x8981;&#x6539;&#x53D8;&#x624D;&#x80FD;&#x53D8;&#x7684;&#x66F4;&#x4F18;&#x3002;</p>
<p>&#x600E;&#x4E48;&#x5206;&#x5757;&#x5462;&#xFF1F;</p>
<p>&#x6211;&#x4EEC;&#x8BBE;&#x5757;&#x957F;&#x5EA6;&#x4E3A; $S$ &#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x4E8E;&#x4EFB;&#x610F;&#x591A;&#x4E2A;&#x5728;&#x540C;&#x4E00;&#x5757;&#x5185;&#x7684;&#x8BE2;&#x95EE;&#xFF0C;&#x632A;&#x52A8;&#x7684;&#x8DDD;&#x79BB;&#x5C31;&#x662F; $n$ &#xFF0C;&#x4E00;&#x5171; $\displaystyle \frac{n}{S}$ &#x4E2A;&#x5757;&#xFF0C;&#x79FB;&#x52A8;&#x7684;&#x603B;&#x6B21;&#x6570;&#x5C31;&#x662F; $\displaystyle \frac{n^2}{S}$ &#xFF0C;&#x79FB;&#x52A8;&#x53EF;&#x80FD;&#x8DE8;&#x8D8A;&#x5757;&#xFF0C;&#x6240;&#x4EE5;&#x8FD8;&#x8981;&#x52A0;&#x4E0A;&#x4E00;&#x4E2A; $mS$ &#x7684;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x603B;&#x590D;&#x6742;&#x5EA6;&#x4E3A; $\displaystyle O\left(\frac{n^2}{S}+mS\right)$ &#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x8BA9;&#x8FD9;&#x4E2A;&#x503C;&#x5C3D;&#x91CF;&#x5C0F;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x8981;&#x5C06;&#x8FD9;&#x4E24;&#x4E2A;&#x9879;&#x5C3D;&#x91CF;&#x76F8;&#x7B49;&#xFF0C;&#x53D1;&#x73B0; $S$ &#x53D6; $\displaystyle \frac{n}{\sqrt{m}}$ &#x662F;&#x6700;&#x4F18;&#x7684;&#xFF0C;&#x6B64;&#x65F6;&#x590D;&#x6742;&#x5EA6;&#x4E3A; $\displaystyle O\left(\frac{n^2}{\displaystyle \frac{n}{\sqrt{m}}}+m\left(\frac{n}{\sqrt{m}}\right)\right)=O(n\sqrt{m})$ &#x3002;</p>
<h3 id="&#x4F8B;&#x9898;--&#x4EE3;&#x7801;">&#x4F8B;&#x9898; &amp; &#x4EE3;&#x7801;</h3>
<p>???+note &quot;&#x4F8B;&#x9898;<a href="https://www.luogu.org/problem/P1494" target="_blank">&#x5C0F; Z &#x7684;&#x889C;&#x5B50;</a>&quot;
    &#x9898;&#x76EE;&#x5927;&#x610F;&#xFF1A;</p>
<pre><code>&#x6709;&#x4E00;&#x4E2A;&#x957F;&#x5EA6;&#x4E3A; $n$ &#x7684;&#x5E8F;&#x5217; $\{c_i\}$ &#x3002;&#x73B0;&#x5728;&#x7ED9;&#x51FA; $m$ &#x4E2A;&#x8BE2;&#x95EE;&#xFF0C;&#x6BCF;&#x6B21;&#x7ED9;&#x51FA;&#x4E24;&#x4E2A;&#x6570; $l,r$ &#xFF0C;&#x4ECE;&#x7F16;&#x53F7;&#x5728; $l$ &#x5230; $r$ &#x4E4B;&#x95F4;&#x7684;&#x6570;&#x4E2D;&#x968F;&#x673A;&#x9009;&#x51FA;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x6570;&#xFF0C;&#x6C42;&#x4E24;&#x4E2A;&#x6570;&#x76F8;&#x7B49;&#x7684;&#x6982;&#x7387;&#x3002;
</code></pre><p>&#x601D;&#x8DEF;&#xFF1A;&#x83AB;&#x961F;&#x7B97;&#x6CD5;&#x6A21;&#x677F;&#x9898;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x533A;&#x95F4; $[l,r]$ &#xFF0C;&#x4EE5; $l$ &#x6240;&#x5728;&#x5757;&#x7684;&#x7F16;&#x53F7;&#x4E3A;&#x7B2C;&#x4E00;&#x5173;&#x952E;&#x5B57;&#xFF0C; $r$ &#x4E3A;&#x7B2C;&#x4E8C;&#x5173;&#x952E;&#x5B57;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x6392;&#x5E8F;&#x3002;</p>
<p>&#x7136;&#x540E;&#x4ECE;&#x5E8F;&#x5217;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8BE2;&#x95EE;&#x5F00;&#x59CB;&#x8BA1;&#x7B97;&#x7B54;&#x6848;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x8BE2;&#x95EE;&#x901A;&#x8FC7;&#x76F4;&#x63A5;&#x66B4;&#x529B;&#x7B97;&#x51FA;&#xFF0C;&#x590D;&#x6742;&#x5EA6;&#x4E3A; $O(n)$ &#xFF0C;&#x540E;&#x9762;&#x7684;&#x8BE2;&#x95EE;&#x5728;&#x524D;&#x4E00;&#x4E2A;&#x8BE2;&#x95EE;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x5F97;&#x5230;&#x7B54;&#x6848;&#x3002;</p>
<p>&#x5177;&#x4F53;&#x505A;&#x6CD5;&#xFF1A;</p>
<p>&#x5BF9;&#x4E8E;&#x533A;&#x95F4; $[i,i]$ &#xFF0C;&#x7531;&#x4E8E;&#x533A;&#x95F4;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x6211;&#x4EEC;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x80FD;&#x77E5;&#x9053;&#x7B54;&#x6848;&#x3002;&#x7136;&#x540E;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x4ECE;&#x5F53;&#x524D;&#x533A;&#x95F4;&#xFF08;&#x5DF2;&#x77E5;&#x7B54;&#x6848;&#xFF09;&#x5411;&#x4E0B;&#x4E00;&#x4E2A;&#x533A;&#x95F4;&#x9760;&#x8FD1;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x8BBE; $col[i]$ &#x8868;&#x793A;&#x5F53;&#x524D;&#x989C;&#x8272; i &#x51FA;&#x73B0;&#x4E86;&#x591A;&#x5C11;&#x6B21;&#xFF0C; $ans$ &#x5F53;&#x524D;&#x5171;&#x6709;&#x591A;&#x5C11;&#x79CD;&#x53EF;&#x884C;&#x7684;&#x914D;&#x5BF9;&#x65B9;&#x6848;&#xFF08;&#x6709;&#x591A;&#x5C11;&#x79CD;&#x53EF;&#x4EE5;&#x9009;&#x5230;&#x4E00;&#x53CC;&#x989C;&#x8272;&#x76F8;&#x540C;&#x7684;&#x889C;&#x5B50;&#xFF09;&#xFF0C;&#x8868;&#x793A;&#x7136;&#x540E;&#x6BCF;&#x6B21;&#x79FB;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x66F4;&#x65B0;&#x7B54;&#x6848;&#x2014;&#x2014;&#x8BBE;&#x5F53;&#x524D;&#x989C;&#x8272;&#x4E3A; $k$ &#xFF0C;&#x5982;&#x679C;&#x662F;&#x589E;&#x957F;&#x533A;&#x95F4;&#x5C31;&#x662F; $ans$ &#x52A0;&#x4E0A; $C<em>{col[k]+1}^2-C</em>{col[k]}^2$ &#xFF0C;&#x5982;&#x679C;&#x662F;&#x7F29;&#x77ED;&#x5C31;&#x662F; $ans$ &#x51CF;&#x53BB; $C<em>{col[k]}^2-C</em>{col[k]-1}^2$ &#x3002;&#x8FD9;&#x5E94;&#x8BE5;&#x5F88;&#x597D;&#x7406;&#x89E3;&#x3002;</p>
<p>&#x800C;&#x8FD9;&#x4E2A;&#x8BE2;&#x95EE;&#x7684;&#x7B54;&#x6848;&#x5C31;&#x662F; $\displaystyle \frac{ans}{C_{r-l+1}^2}$ &#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x4F18;&#x5316;&#xFF1A; $\displaystyle C_a^2=\frac{a (a-1)}{2}$ &#x3002;</p>
<p>&#x6240;&#x4EE5; $\displaystyle C_{a+1}^2-C_a^2=\frac{(a+1) a}{2}-\frac{a (a-1)}{2}=\frac{a}{2}\cdot (a+1-a+1)=\frac{a}{2}\cdot 2=a$ &#x3002;</p>
<p>&#x6240;&#x4EE5; $C<em>{col[k]+1}^2-C</em>{col[k]}^2=col[k]$ &#x3002;</p>
<p>&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C11;&#x7B97;&#x4E86;&#x5F88;&#x591A;&#x4E1C;&#x897F;&#x5462;&#xFF01;
&#x81F3;&#x5C11;&#x6211;&#x7684;&#x4EE3;&#x7801;&#x5728; BZOJ &#x4E0A;&#x6D4B;&#x5FEB;&#x4E86;&#x4E00;&#x500D;&#x3002;</p>
<p>&#x8FD8;&#x6709;&#xFF0C;&#x7B97; $C_a^2$ &#x53EF;&#x4EE5;&#x7528;&#x4F4D;&#x8FD0;&#x7B97;&#xFF0C; <code>a/2</code> &#x53EF;&#x4EE5;&#x5199;&#x6210; <code>a&gt;&gt;1</code> &#x3002;</p>
<p>&#x7B97;&#x6CD5;&#x603B;&#x590D;&#x6742;&#x5EA6;&#xFF1A; $O(n\sqrt{n} )$ </p>
<p>&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4E2D; <code>mot</code> &#x8868;&#x793A;&#x7B54;&#x6848;&#x7684;&#x5206;&#x6BCD; (mother)&#xFF0C; <code>sub</code> &#x8868;&#x793A;&#x5206;&#x5B50;&#xFF0C; <code>sqn</code> &#x8868;&#x793A;&#x5757;&#x7684;&#x5927;&#x5C0F;&#xFF1A; $\sqrt{n}$ &#xFF0C; <code>arr</code> &#x662F;&#x8F93;&#x5165;&#x7684;&#x6570;&#x7EC4;&#xFF0C; <code>node</code> &#x662F;&#x5B58;&#x50A8;&#x8BE2;&#x95EE;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#xFF0C; <code>tab</code> &#x662F;&#x8BE2;&#x95EE;&#x5E8F;&#x5217;&#xFF08;&#x6392;&#x5E8F;&#x540E;&#x7684;&#xFF09;&#xFF0C; <code>col</code> &#x540C;&#x4E0A;&#x6240;&#x8FF0;&#x3002;</p>
<p> <strong>&#x6CE8;&#x610F;&#xFF1A;&#x7531;&#x4E8E; <code>++l</code> &#x548C; <code>--r</code> &#x7684;&#x5B58;&#x5728;&#xFF0C;&#x4E0B;&#x9762;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x79FB;&#x52A8;&#x533A;&#x95F4;&#x7684; 4 &#x4E2A; for &#x5FAA;&#x73AF;&#x7684;&#x4F4D;&#x7F6E;&#x5F88;&#x5173;&#x952E;&#xFF0C;&#x4E0D;&#x80FD;&#x6539;&#x53D8;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x4F4D;&#x7F6E;&#x5173;&#x7CFB;&#x3002;</strong> </p>
<p>??? &#x53C2;&#x8003;&#x4EE3;&#x7801;</p>
<pre><code>```cpp
#include &lt;bits/stdc++.h&gt;
#define bi(a) ((a - 1) / sqn + 1)
using namespace std;
typedef long long LL;
template &lt;typename tp&gt;
void read(tp&amp; dig) {
  char c = getchar();
  dig = 0;
  while (!isdigit(c)) c = getchar();
  while (isdigit(c)) dig = dig * 10 + c - &apos;0&apos;, c = getchar();
}
struct node {
  LL l, r, i;
};
LL n, m, sqn, arr[50005], l, r, ans, col[50005], sub[50005], mot[50005];
vector&lt;node&gt; tab;
bool cmp(node a, node b) {
  if (bi(a.l) == bi(b.l)) return a.r &lt; b.r;
  return a.l &lt; b.l;
}
LL gcd(LL a, LL b) { return !b ? a : gcd(b, a % b); }
int main() {
  read(n), read(m), sqn = sqrt(n);
  for (LL i = 1; i &lt;= n; i++) read(arr[i]);
  for (LL i = 1, a, b; i &lt;= m; i++)
    read(a), read(b), tab.push_back((node){a, b, i});
  sort(tab.begin(), tab.end(), cmp), l = r = tab[0].l, col[arr[l]]++;
  for (LL i = 0, gcdnum; i &lt; tab.size(); i++) {
    for (; l &lt; tab[i].l; l++) col[arr[l]]--, ans -= col[arr[l]];
    for (--l; l &gt;= tab[i].l; l--) ans += col[arr[l]], col[arr[l]]++;
    for (; r &gt; tab[i].r; r--) col[arr[r]]--, ans -= col[arr[r]];
    for (++r; r &lt;= tab[i].r; r++) ans += col[arr[r]], col[arr[r]]++;
    sub[tab[i].i] = ans, l = tab[i].l, r = tab[i].r;
    mot[tab[i].i] = ((r - l) * (r - l + 1)) &gt;&gt; 1;
  }
  for (LL i = 1, gcdn; i &lt;= m; i++)
    gcdn = gcd(sub[i], mot[i]),
    printf(&quot;%lld/%lld\n&quot;, sub[i] / gcdn, mot[i] / gcdn);
  return 0;
}
```
</code></pre><h2 id="&#x666E;&#x901A;&#x83AB;&#x961F;&#x7684;&#x4F18;&#x5316;">&#x666E;&#x901A;&#x83AB;&#x961F;&#x7684;&#x4F18;&#x5316;</h2>
<p>&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E0B;&#x4E0B;&#x9762;&#x8FD9;&#x7EC4;&#x6570;&#x636E;</p>
<pre><code class="lang-text">// &#x8BBE;&#x5757;&#x7684;&#x5927;&#x5C0F;&#x4E3A; 2 (&#x5047;&#x8BBE;)
1 1
2 100
3 1
4 100
</code></pre>
<p>&#x624B;&#x52A8;&#x6A21;&#x62DF;&#x4E00;&#x4E0B;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;r &#x6307;&#x9488;&#x7684;&#x79FB;&#x52A8;&#x6B21;&#x6570;&#x5927;&#x6982;&#x4E3A; 300 &#x6B21;&#xFF0C;&#x6211;&#x4EEC;&#x5904;&#x7406;&#x5B8C;&#x7B2C;&#x4E00;&#x4E2A;&#x5757;&#x4E4B;&#x540E;&#xFF0C; $l = 2, r = 100$ &#xFF0C;&#x6B64;&#x65F6;&#x53EA;&#x9700;&#x8981;&#x79FB;&#x52A8;&#x4E24;&#x6B21; l &#x6307;&#x9488;&#x5C31;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x7B2C;&#x56DB;&#x4E2A;&#x8BE2;&#x95EE;&#x7684;&#x7B54;&#x6848;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x5374;&#x5C06; r &#x6307;&#x9488;&#x79FB;&#x52A8;&#x5230; 1 &#x6765;&#x83B7;&#x53D6;&#x7B2C;&#x4E09;&#x4E2A;&#x8BE2;&#x95EE;&#x7684;&#x7B54;&#x6848;&#xFF0C;&#x518D;&#x79FB;&#x52A8;&#x5230; 100 &#x83B7;&#x53D6;&#x7B2C;&#x56DB;&#x4E2A;&#x8BE2;&#x95EE;&#x7684;&#x7B54;&#x6848;&#xFF0C;&#x8FD9;&#x6837;&#x591A;&#x4E86;&#x4E5D;&#x5341;&#x51E0;&#x6B21;&#x7684;&#x6307;&#x9488;&#x79FB;&#x52A8;&#x3002;&#x6211;&#x4EEC;&#x600E;&#x4E48;&#x4F18;&#x5316;&#x8FD9;&#x4E2A;&#x5730;&#x65B9;&#x5462;&#xFF1F;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x7528;&#x5230;&#x5947;&#x5076;&#x5316;&#x6392;&#x5E8F;&#x3002;</p>
<p>&#x4EC0;&#x4E48;&#x662F;&#x5947;&#x5076;&#x5316;&#x6392;&#x5E8F;&#xFF1F;&#x5947;&#x5076;&#x5316;&#x6392;&#x5E8F;&#x5373;&#x5BF9;&#x4E8E;&#x5C5E;&#x4E8E;&#x5947;&#x6570;&#x5757;&#x7684;&#x8BE2;&#x95EE;&#xFF0C;r &#x6309;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x6392;&#x5E8F;&#xFF0C;&#x5BF9;&#x4E8E;&#x5C5E;&#x4E8E;&#x5076;&#x6570;&#x5757;&#x7684;&#x6392;&#x5E8F;&#xFF0C;r &#x4ECE;&#x5927;&#x5230;&#x5C0F;&#x6392;&#x5E8F;&#xFF0C;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x7684; r &#x6307;&#x9488;&#x5728;&#x5904;&#x7406;&#x5B8C;&#x8FD9;&#x4E2A;&#x5947;&#x6570;&#x5757;&#x7684;&#x95EE;&#x9898;&#x540E;&#xFF0C;&#x5C06;&#x5728;&#x8FD4;&#x56DE;&#x7684;&#x9014;&#x4E2D;&#x5904;&#x7406;&#x5076;&#x6570;&#x5757;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x518D;&#x5411; n &#x79FB;&#x52A8;&#x5904;&#x7406;&#x4E0B;&#x4E00;&#x4E2A;&#x5947;&#x6570;&#x5757;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4F18;&#x5316;&#x4E86; r &#x6307;&#x9488;&#x7684;&#x79FB;&#x52A8;&#x6B21;&#x6570;&#xFF0C;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x79CD;&#x4F18;&#x5316;&#x80FD;&#x8BA9;&#x7A0B;&#x5E8F;&#x5FEB; 30% &#x5DE6;&#x53F3;&#x3002;</p>
<p>&#x6392;&#x5E8F;&#x4EE3;&#x7801;&#xFF1A;</p>
<p>&#x538B;&#x884C;</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// &#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x5C0F;&#x7EC6;&#x8282;&#x7B49;&#x4E0B;&#x4F1A;&#x8BB2;</span>
<span class="hljs-keyword">int</span> unit;  <span class="hljs-comment">// &#x5757;&#x7684;&#x5927;&#x5C0F;</span>
<span class="hljs-keyword">struct</span> node {
  <span class="hljs-keyword">int</span> l, r, id;
  <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> node &amp;x) <span class="hljs-keyword">const</span> {
    <span class="hljs-keyword">return</span> l / unit == x.l / unit
               ? (r == x.r ? <span class="hljs-number">0</span> : ((l / unit) &amp; <span class="hljs-number">1</span>) ^ (r &lt; x.r))
               : l &lt; x.l;
  }
};
</code></pre>
<p>&#x4E0D;&#x538B;&#x884C;</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">struct</span> node {
  <span class="hljs-keyword">int</span> l, r, id;
  <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> node &amp;x) <span class="hljs-keyword">const</span> {
    <span class="hljs-keyword">if</span> (l / unit != x.l / unit) <span class="hljs-keyword">return</span> l &lt; x.l;
    <span class="hljs-keyword">if</span> ((l / unit) &amp; <span class="hljs-number">1</span>)
      <span class="hljs-keyword">return</span> r &lt;
             x.r;  <span class="hljs-comment">// &#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x548C;&#x4E0B;&#x9762;&#x4E00;&#x884C;&#x4E0D;&#x80FD;&#x5199;&#x5C0F;&#x4E8E;&#xFF08;&#x5927;&#x4E8E;&#xFF09;&#x7B49;&#x4E8E;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x51FA;&#x9519;&#xFF08;&#x8BE6;&#x89C1;&#x4E0B;&#x9762;&#x7684;&#x5C0F;&#x7EC6;&#x8282;&#xFF09;</span>
    <span class="hljs-keyword">return</span> r &gt; x.r;
  }
};
</code></pre>
<p>!!! warning
    &#x5C0F;&#x7EC6;&#x8282;&#xFF1A;&#x5982;&#x679C;&#x4F7F;&#x7528; sort &#x6BD4;&#x8F83;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4E0D;&#x80FD;&#x51FA;&#x73B0; $a &lt; b$ &#x548C; $b &lt; a$ &#x540C;&#x65F6;&#x4E3A;&#x771F;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x8FD0;&#x884C;&#x9519;&#x8BEF;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x538B;&#x884C;&#x7248;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709; <code>r == x.r</code> &#x7684;&#x7279;&#x5224;&#xFF0C;&#x5F53; l &#x5C5E;&#x4E8E;&#x540C;&#x4E00;&#x5947;&#x6570;&#x5757;&#x4E14; r &#x76F8;&#x7B49;&#x65F6;&#xFF0C;&#x4F1A;&#x51FA;&#x73B0;&#x4E0A;&#x9762;&#x5C0F;&#x7EC6;&#x8282;&#x4E2D;&#x7684;&#x95EE;&#x9898;&#xFF08;&#x81EA;&#x5DF1;&#x624B;&#x52A8;&#x6A21;&#x62DF;&#x4E00;&#x4E0B;&#xFF09;&#xFF0C;&#x5BF9;&#x4E8E;&#x538B;&#x884C;&#x7248;&#xFF0C;&#x5982;&#x679C;&#x5199;&#x6210;&#x5C0F;&#x4E8E;&#xFF08;&#x5927;&#x4E8E;&#xFF09;&#x7B49;&#x4E8E;&#xFF0C;&#x5219;&#x4E5F;&#x4F1A;&#x51FA;&#x73B0;&#x540C;&#x6837;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<h2 id="&#x5E26;&#x4FEE;&#x6539;">&#x5E26;&#x4FEE;&#x6539;</h2>
<p>&#x8BF7;&#x786E;&#x4FDD;&#x60A8;&#x5DF2;&#x7ECF;&#x4F1A;&#x666E;&#x901A;&#x83AB;&#x961F;&#x7B97;&#x6CD5;&#x4E86;&#x3002;&#x5982;&#x679C;&#x60A8;&#x8FD8;&#x4E0D;&#x4F1A;&#xFF0C;&#x8BF7;&#x5148;&#x9605;&#x8BFB;&#x4E0A;&#x9762;&#x7684;&#x201C;&#x666E;&#x901A;&#x83AB;&#x961F;&#x7B97;&#x6CD5;&#x201D;&#x3002;</p>
<h3 id="&#x7279;&#x70B9;">&#x7279;&#x70B9;</h3>
<p>&#x666E;&#x901A;&#x83AB;&#x961F;&#x662F;&#x4E0D;&#x80FD;&#x5E26;&#x4FEE;&#x6539;&#x7684;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F3A;&#x884C;&#x8BA9;&#x5B83;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#xFF0C;&#x5C31;&#x50CF; DP &#x4E00;&#x6837;&#xFF0C;&#x53EF;&#x4EE5;&#x5F3A;&#x884C;&#x52A0;&#x4E0A;&#x4E00;&#x7EF4; <strong>&#x65F6;&#x95F4;&#x7EF4;</strong> , &#x8868;&#x793A;&#x8FD9;&#x6B21;&#x64CD;&#x4F5C;&#x7684;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x65F6;&#x95F4;&#x7EF4;&#x8868;&#x793A;&#x7ECF;&#x5386;&#x7684;&#x4FEE;&#x6539;&#x6B21;&#x6570;&#x3002;</p>
<p>&#x5373;&#x628A;&#x8BE2;&#x95EE; $[l,r]$ &#x53D8;&#x6210; $[l,r,time]$ &#x3002;</p>
<p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x7684;&#x5750;&#x6807;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x65F6;&#x95F4;&#x7EF4;&#x4E0A;&#x79FB;&#x52A8;&#xFF0C;&#x5373; $[l,r,time]$ &#x591A;&#x4E86;&#x4E00;&#x7EF4;&#x53EF;&#x4EE5;&#x79FB;&#x52A8;&#x7684;&#x65B9;&#x5411;&#xFF0C;&#x53EF;&#x4EE5;&#x53D8;&#x6210;&#xFF1A;</p>
<ul>
<li>$[l-1,r,time]$ </li>
<li>$[l+1,r,time]$ </li>
<li>$[l,r-1,time]$ </li>
<li>$[l,r+1,time]$ </li>
<li>$[l,r,time-1]$ </li>
<li>$[l,r,time+1]$ </li>
</ul>
<p>&#x8FD9;&#x6837;&#x7684;&#x8F6C;&#x79FB;&#x4E5F;&#x662F; $O(1)$ &#x7684;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x6392;&#x5E8F;&#x53C8;&#x591A;&#x4E86;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x518D;&#x641E;&#x641E;&#x5C31;&#x884C;&#x4E86;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x7528;&#x548C;&#x666E;&#x901A;&#x83AB;&#x961F;&#x7C7B;&#x4F3C;&#x7684;&#x65B9;&#x6CD5;&#x6392;&#x5E8F;&#x8F6C;&#x79FB;&#xFF0C;&#x505A;&#x5230; $O(n^{\frac{5}{3}})$ &#x3002;</p>
<p>&#x8FD9;&#x4E00;&#x6B21;&#x6211;&#x4EEC;&#x6392;&#x5E8F;&#x7684;&#x65B9;&#x5F0F;&#x662F;&#x4EE5; $n^{\frac{2}{3}}$ &#x4E3A;&#x4E00;&#x5757;&#xFF0C;&#x5206;&#x6210;&#x4E86; $n^{\frac{1}{3}}$ &#x5757;&#xFF0C;&#x7B2C;&#x4E00;&#x5173;&#x952E;&#x5B57;&#x662F;&#x5DE6;&#x7AEF;&#x70B9;&#x6240;&#x5728;&#x5757;&#xFF0C;&#x7B2C;&#x4E8C;&#x5173;&#x952E;&#x5B57;&#x662F;&#x53F3;&#x7AEF;&#x70B9;&#x6240;&#x5728;&#x5757;&#xFF0C;&#x7B2C;&#x4E09;&#x5173;&#x952E;&#x5B57;&#x662F;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x8FD8;&#x662F;&#x6765;&#x8BC1;&#x660E;&#x4E00;&#x4E0B;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#xFF08;&#x9ED8;&#x8BA4;&#x5757;&#x5927;&#x5C0F;&#x4E3A; $\sqrt{n}$ &#xFF09;&#xFF1A;</p>
<ul>
<li>&#x5DE6;&#x53F3;&#x7AEF;&#x70B9;&#x6240;&#x5728;&#x5757;&#x4E0D;&#x53D8;&#xFF0C;&#x65F6;&#x95F4;&#x5728;&#x6392;&#x5E8F;&#x540E;&#x5355;&#x8C03;&#x5411;&#x53F3;&#x79FB;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x590D;&#x6742;&#x5EA6;&#x662F; $O(n)$ &#xFF1B;</li>
<li>&#x82E5;&#x5DE6;&#x53F3;&#x7AEF;&#x70B9;&#x6240;&#x5728;&#x5757;&#x6539;&#x53D8;&#xFF0C;&#x65F6;&#x95F4;&#x4E00;&#x6B21;&#x6700;&#x591A;&#x4F1A;&#x79FB;&#x52A8; n &#x4E2A;&#x683C;&#x5B50;&#xFF0C;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6; $O(n)$ &#xFF1B;</li>
<li>&#x5DE6;&#x7AEF;&#x70B9;&#x6240;&#x5728;&#x5757;&#x4E00;&#x5171;&#x6709; $n^{\frac{1}{3}}$ &#x4E2D;&#xFF0C;&#x53F3;&#x7AEF;&#x70B9;&#x4E5F;&#x662F; $n^{\frac{1}{3}}$ &#x79CD;&#xFF0C;&#x4E00;&#x5171; ${n^{\frac{1}{3}}}\times{n^{\frac{1}{3}}}=n^{\frac{2}{3}}$ &#x79CD;&#xFF0C;&#x6BCF;&#x79CD;&#x4E58;&#x4E0A;&#x79FB;&#x52A8;&#x7684;&#x590D;&#x6742;&#x5EA6; $O(n)$ &#xFF0C;&#x603B;&#x590D;&#x6742;&#x5EA6; $O(n^{\frac{5}{3}})$ &#x3002;</li>
</ul>
<h3 id="&#x4F8B;&#x9898;">&#x4F8B;&#x9898;</h3>
<p>???+note &quot;&#x4F8B;&#x9898;<a href="https://www.luogu.org/problem/P1903" target="_blank">&#x6570;&#x989C;&#x8272; BZOJ - 2120</a>&quot;</p>
<pre><code>&#x9898;&#x76EE;&#x5927;&#x610F;&#xFF1A;&#x7ED9;&#x4F60;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#xFF0C;M &#x4E2A;&#x64CD;&#x4F5C;&#xFF0C;&#x6709;&#x4E24;&#x79CD;&#x64CD;&#x4F5C;&#xFF1A;

1.  &#x4FEE;&#x6539;&#x5E8F;&#x5217;&#x4E0A;&#x67D0;&#x4E00;&#x4F4D;&#x7684;&#x6570;&#x5B57;
2.  &#x8BE2;&#x95EE;&#x533A;&#x95F4; $[l,r]$ &#x4E2D;&#x6570;&#x5B57;&#x7684;&#x79CD;&#x7C7B;&#x6570;&#xFF08;&#x591A;&#x4E2A;&#x76F8;&#x540C;&#x7684;&#x6570;&#x5B57;&#x53EA;&#x7B97;&#x4E00;&#x4E2A;&#xFF09;
</code></pre><p>&#x6211;&#x4EEC;&#x4E0D;&#x96BE;&#x53D1;&#x73B0;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5E26;&#x64CD;&#x4F5C; 1&#xFF08;&#x4FEE;&#x6539;&#xFF09;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x80FD;&#x8F7B;&#x677E;&#x7528;&#x666E;&#x901A;&#x83AB;&#x961F;&#x89E3;&#x51B3;&#x3002;</p>
<p>&#x4F46;&#x662F;&#x9898;&#x76EE;&#x8FD8;&#x5E26;&#x5355;&#x70B9;&#x4FEE;&#x6539;&#xFF0C;&#x6240;&#x4EE5;&#x7528; <strong>&#x5E26;&#x4FEE;&#x6539;&#x7684;&#x83AB;&#x961F;</strong> &#x3002;</p>
<p>&#x5148;&#x8003;&#x8651;&#x666E;&#x901A;&#x83AB;&#x961F;&#x7684;&#x505A;&#x6CD5;&#xFF1A;</p>
<ul>
<li>&#x6BCF;&#x6B21;&#x6269;&#x5927;&#x533A;&#x95F4;&#x65F6;&#xFF0C;&#x6BCF;&#x52A0;&#x5165;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;&#x5219;&#x7EDF;&#x8BA1;&#x5B83;&#x5DF2;&#x7ECF;&#x51FA;&#x73B0;&#x7684;&#x6B21;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x52A0;&#x5165;&#x524D;&#x8FD9;&#x79CD;&#x6570;&#x5B57;&#x51FA;&#x73B0;&#x6B21;&#x6570;&#x4E3A; $0$ &#xFF0C;&#x5219;&#x8BF4;&#x660E;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x65B0;&#x7684;&#x6570;&#x5B57;&#xFF0C;&#x7B54;&#x6848; $+1$ &#x3002;&#x7136;&#x540E;&#x8FD9;&#x79CD;&#x6570;&#x5B57;&#x7684;&#x51FA;&#x73B0;&#x6B21;&#x6570; $+1$ &#x3002;</li>
<li>&#x6BCF;&#x6B21;&#x51CF;&#x5C0F;&#x533A;&#x95F4;&#x65F6;&#xFF0C;&#x6BCF;&#x5220;&#x9664;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;&#x5219;&#x7EDF;&#x8BA1;&#x5B83;&#x5220;&#x9664;&#x540E;&#x7684;&#x51FA;&#x73B0;&#x6B21;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x5220;&#x9664;&#x540E;&#x8FD9;&#x79CD;&#x6570;&#x5B57;&#x51FA;&#x73B0;&#x6B21;&#x6570;&#x4E3A; $0$ &#xFF0C;&#x5219;&#x8BF4;&#x660E;&#x8FD9;&#x79CD;&#x6570;&#x5B57;&#x5DF2;&#x7ECF;&#x4ECE;&#x5F53;&#x524D;&#x7684;&#x533A;&#x95F4;&#x5185;&#x5220;&#x5149;&#x4E86;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5F53;&#x524D;&#x533A;&#x95F4;&#x51CF;&#x5C11;&#x4E86;&#x4E00;&#x79CD;&#x989C;&#x8272;&#xFF0C;&#x7B54;&#x6848; $-1$ &#x3002;&#x7136;&#x540E;&#x8FD9;&#x79CD;&#x6570;&#x5B57;&#x7684;&#x51FA;&#x73B0;&#x6B21;&#x6570; $-1$ &#x3002;</li>
</ul>
<p>&#x73B0;&#x5728;&#x518D;&#x6765;&#x8003;&#x8651;&#x4FEE;&#x6539;&#xFF1A;</p>
<ul>
<li>&#x5355;&#x70B9;&#x4FEE;&#x6539;&#xFF0C;&#x628A;&#x67D0;&#x4E00;&#x4F4D;&#x7684;&#x6570;&#x5B57;&#x4FEE;&#x6539;&#x6389;&#x3002;&#x5047;&#x5982;&#x6211;&#x4EEC;&#x662F;&#x4ECE;&#x4E00;&#x4E2A;&#x7ECF;&#x5386;&#x4FEE;&#x6539;&#x6B21;&#x6570;&#x4E3A; $i$ &#x7684;&#x8BE2;&#x95EE;&#x8F6C;&#x79FB;&#x5230;&#x4E00;&#x4E2A;&#x7ECF;&#x5386;&#x4FEE;&#x6539;&#x6B21;&#x6570;&#x4E3A; $j$ &#x7684;&#x8BE2;&#x95EE;&#x4E0A;&#xFF0C;&#x4E14; $i&lt;j$ &#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x628A;&#x7B2C; $i+1$ &#x4E2A;&#x5230;&#x7B2C; $j$ &#x4E2A;&#x4FEE;&#x6539;&#x5F3A;&#x884C;&#x52A0;&#x4E0A;&#x3002;</li>
<li>&#x5047;&#x5982; $j&lt;i$ &#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x628A;&#x7B2C; $i$ &#x4E2A;&#x5230;&#x7B2C; $j+1$ &#x4E2A;&#x4FEE;&#x6539;&#x5F3A;&#x884C;&#x8FD8;&#x539F;&#x3002;</li>
</ul>
<p>&#x600E;&#x4E48;&#x5F3A;&#x884C;&#x52A0;&#x4E0A;&#x4E00;&#x4E2A;&#x4FEE;&#x6539;&#x5462;&#xFF1F;&#x5047;&#x8BBE;&#x4E00;&#x4E2A;&#x4FEE;&#x6539;&#x662F;&#x4FEE;&#x6539;&#x7B2C; $pos$ &#x4E2A;&#x4F4D;&#x7F6E;&#x4E0A;&#x7684;&#x989C;&#x8272;&#xFF0C;&#x539F;&#x672C; $pos$ &#x4E0A;&#x7684;&#x989C;&#x8272;&#x4E3A; $a$ &#xFF0C;&#x4FEE;&#x6539;&#x540E;&#x989C;&#x8272;&#x4E3A; $b$ &#xFF0C;&#x8FD8;&#x5047;&#x8BBE;&#x5F53;&#x524D;&#x83AB;&#x961F;&#x7684;&#x533A;&#x95F4;&#x6269;&#x5C55;&#x5230;&#x4E86; $[l,r]$ &#x3002;</p>
<ul>
<li>&#x52A0;&#x4E0A;&#x8FD9;&#x4E2A;&#x4FEE;&#x6539;&#xFF1A;&#x6211;&#x4EEC;&#x9996;&#x5148;&#x5224;&#x65AD; $pos$ &#x662F;&#x5426;&#x5728;&#x533A;&#x95F4; $[l,r]$ &#x5185;&#x3002;&#x5982;&#x679C;&#x662F;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x7B49;&#x4E8E;&#x662F;&#x4ECE;&#x533A;&#x95F4;&#x4E2D;&#x5220;&#x6389;&#x989C;&#x8272; $a$ &#xFF0C;&#x52A0;&#x4E0A;&#x989C;&#x8272; $b$ &#xFF0C;&#x5E76;&#x4E14;&#x5F53;&#x524D;&#x989C;&#x8272;&#x5E8F;&#x5217;&#x7684;&#x7B2C; $pos$ &#x9879;&#x7684;&#x989C;&#x8272;&#x6539;&#x6210; $b$ &#x3002;&#x5982;&#x679C;&#x4E0D;&#x5728;&#x533A;&#x95F4; $[l,r]$ &#x5185;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x5F53;&#x524D;&#x989C;&#x8272;&#x5E8F;&#x5217;&#x7684;&#x7B2C; $pos$ &#x9879;&#x4E3A; $b$ &#x3002;</li>
<li>&#x8FD8;&#x539F;&#x8FD9;&#x4E2A;&#x4FEE;&#x6539;&#xFF1A;&#x7B49;&#x4E8E;&#x52A0;&#x4E0A;&#x4E00;&#x4E2A;&#x4FEE;&#x6539;&#x7B2C; $pos$ &#x9879;&#x3001;&#x628A;&#x989C;&#x8272; $b$ &#x6539;&#x6210;&#x989C;&#x8272; $a$ &#x7684;&#x4FEE;&#x6539;&#x3002;</li>
</ul>
<p>&#x56E0;&#x6B64;&#x8FD9;&#x9053;&#x9898;&#x5C31;&#x8FD9;&#x6837;&#x7528;&#x5E26;&#x4FEE;&#x6539;&#x83AB;&#x961F;&#x8F7B;&#x677E;&#x89E3;&#x51B3;&#x5566;&#xFF01;</p>
<p>??? &#x53C2;&#x8003;&#x4EE3;&#x7801;</p>
<pre><code>```cpp
#include &lt;bits/stdc++.h&gt;
#define SZ (10005)
using namespace std;
template &lt;typename _Tp&gt;
inline void IN(_Tp&amp; dig) {
  char c;
  dig = 0;
  while (c = getchar(), !isdigit(c))
    ;
  while (isdigit(c)) dig = dig * 10 + c - &apos;0&apos;, c = getchar();
}
int n, m, sqn, c[SZ], ct[SZ], c1, c2, mem[SZ][3], ans, tot[1000005], nal[SZ];
struct query {
  int l, r, i, c;
  bool operator&lt;(const query another) const {
    if (l / sqn == another.l / sqn) {
      if (r / sqn == another.r / sqn) return i &lt; another.i;
      return r &lt; another.r;
    }
    return l &lt; another.l;
  }
} Q[SZ];
void add(int a) {
  if (!tot[a]) ans++;
  tot[a]++;
}
void del(int a) {
  tot[a]--;
  if (!tot[a]) ans--;
}
char opt[10];
int main() {
  IN(n), IN(m), sqn = pow(n, (double)2 / (double)3);
  for (int i = 1; i &lt;= n; i++) IN(c[i]), ct[i] = c[i];
  for (int i = 1, a, b; i &lt;= m; i++)
    if (scanf(&quot;%s&quot;, opt), IN(a), IN(b), opt[0] == &apos;Q&apos;)
      Q[c1].l = a, Q[c1].r = b, Q[c1].i = c1, Q[c1].c = c2, c1++;
    else
      mem[c2][0] = a, mem[c2][1] = ct[a], mem[c2][2] = ct[a] = b, c2++;
  sort(Q, Q + c1), add(c[1]);
  int l = 1, r = 1, lst = 0;
  for (int i = 0; i &lt; c1; i++) {
    for (; lst &lt; Q[i].c; lst++) {
      if (l &lt;= mem[lst][0] &amp;&amp; mem[lst][0] &lt;= r)
        del(mem[lst][1]), add(mem[lst][2]);
      c[mem[lst][0]] = mem[lst][2];
    }
    for (; lst &gt; Q[i].c; lst--) {
      if (l &lt;= mem[lst - 1][0] &amp;&amp; mem[lst - 1][0] &lt;= r)
        del(mem[lst - 1][2]), add(mem[lst - 1][1]);
      c[mem[lst - 1][0]] = mem[lst - 1][1];
    }
    for (++r; r &lt;= Q[i].r; r++) add(c[r]);
    for (--r; r &gt; Q[i].r; r--) del(c[r]);
    for (--l; l &gt;= Q[i].l; l--) add(c[l]);
    for (++l; l &lt; Q[i].l; l++) del(c[l]);
    nal[Q[i].i] = ans;
  }
  for (int i = 0; i &lt; c1; i++) printf(&quot;%d\n&quot;, nal[i]);
  return 0;
}
```
</code></pre><h2 id="&#x6811;&#x4E0A;&#x83AB;&#x961F;">&#x6811;&#x4E0A;&#x83AB;&#x961F;</h2>
<p>&#x4E00;&#x822C;&#x7684;&#x83AB;&#x961F;&#x53EA;&#x80FD;&#x5904;&#x7406;&#x7EBF;&#x6027;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x628A;&#x6811;&#x5F3A;&#x884C;&#x538B;&#x6210;&#x5E8F;&#x5217;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x6811;&#x7684;&#x62EC;&#x53F7;&#x5E8F;&#x8DD1;&#x4E0B;&#x6765;&#xFF0C;&#x628A;&#x62EC;&#x53F7;&#x5E8F;&#x5206;&#x5757;&#xFF0C;&#x5728;&#x62EC;&#x53F7;&#x5E8F;&#x4E0A;&#x8DD1;&#x83AB;&#x961F;&#x3002;</p>
<p>&#x5177;&#x4F53;&#x600E;&#x4E48;&#x505A;&#x5462;&#xFF1F;</p>
<p>dfs &#x4E00;&#x68F5;&#x6811;&#xFF0C;&#x7136;&#x540E;&#x5982;&#x679C; dfs &#x5230; x &#x70B9;&#xFF0C;&#x5C31; <code>push_back(x)</code> &#xFF0C;dfs &#x5B8C; x &#x70B9;&#xFF0C;&#x5C31;&#x76F4;&#x63A5; <code>push_back(-x)</code> &#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5728;&#x632A;&#x52A8;&#x6307;&#x9488;&#x7684;&#x65F6;&#x5019;&#xFF0C;</p>
<ul>
<li>&#x65B0;&#x52A0;&#x5165;&#x7684;&#x503C;&#x662F; x  ---&gt; <code>add(x)</code> </li>
<li>&#x65B0;&#x52A0;&#x5165;&#x7684;&#x503C;&#x662F; - x ---&gt; <code>del(x)</code> </li>
<li>&#x65B0;&#x5220;&#x9664;&#x7684;&#x503C;&#x662F; x  ---&gt; <code>del(x)</code> </li>
<li>&#x65B0;&#x5220;&#x9664;&#x7684;&#x503C;&#x662F; - x ---&gt; <code>add(x)</code> </li>
</ul>
<p>&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x628A;&#x4E00;&#x68F5;&#x6811;&#x5904;&#x7406;&#x6210;&#x4E86;&#x5E8F;&#x5217;&#x3002;</p>
<p>???+note &quot;&#x4F8B;&#x9898;<a href="http://uoj.ac/problem/58" target="_blank">&#x300C;WC2013&#x300D;&#x7CD6;&#x679C;&#x516C;&#x56ED;</a>&quot;
    &#x9898;&#x610F;&#xFF1A;&#x7ED9;&#x4F60;&#x4E00;&#x68F5;&#x6811;&#xFF0C;&#x6BCF;&#x4E2A;&#x70B9;&#x6709;&#x989C;&#x8272;&#xFF0C;&#x6BCF;&#x6B21;&#x8BE2;&#x95EE;</p>
<pre><code>$$\sum_{c}val_c\sum_{i=1}^{cnt_c}w_i$$ 

&#x5176;&#x4E2D;&#xFF1A;$val$ &#x8868;&#x793A;&#x8BE5;&#x989C;&#x8272;&#x7684;&#x4EF7;&#x503C;&#xFF0C;$cnt$ &#x8868;&#x793A;&#x989C;&#x8272;&#x51FA;&#x73B0;&#x7684;&#x6B21;&#x6570;&#xFF0C;$w$ &#x8868;&#x793A;&#x8BE5;&#x989C;&#x8272;&#x51FA;&#x73B0; $i$ &#x6B21;&#x540E;&#x7684;&#x4EF7;&#x503C;
</code></pre><p>&#x5148;&#x628A;&#x6811;&#x53D8;&#x6210;&#x5E8F;&#x5217;&#xFF0C;&#x7136;&#x540E;&#x6BCF;&#x6B21;&#x6DFB;&#x52A0;/&#x5220;&#x9664;&#x4E00;&#x4E2A;&#x70B9;&#xFF0C;&#x8FD9;&#x4E2A;&#x70B9;&#x7684;&#x5BF9;&#x7B54;&#x6848;&#x7684;&#x7684;&#x8D21;&#x732E;&#x662F;&#x53EF;&#x4EE5;&#x5728; $O(1)$ &#x65F6;&#x95F4;&#x5185;&#x83B7;&#x5F97;&#x7684;&#xFF0C;&#x5373; $val<em>c\times w</em>{cnt_{c+1}}$ </p>
<p>&#x53D1;&#x73B0;&#x56E0;&#x4E3A;&#x4ED6;&#x4F1A;&#x628A;&#x8D77;&#x70B9;&#x7684;&#x5B50;&#x6811;&#x4E5F;&#x626B;&#x4E86;&#x4E00;&#x904D;&#xFF0C;&#x4EA7;&#x751F;&#x591A;&#x4F59;&#x7684;&#x8D21;&#x732E;&#xFF0C;&#x600E;&#x4E48;&#x529E;&#x5462;&#xFF1F;</p>
<p>&#x56E0;&#x4E3A;&#x626B;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x8D77;&#x70B9;&#x7684;&#x5B50;&#x6811;&#x91CC;&#x7684;&#x70B9;&#x80AF;&#x5B9A;&#x4F1A;&#x88AB;&#x626B;&#x4E24;&#x6B21;&#xFF0C;&#x4F46;&#x8D21;&#x732E;&#x4E3A; 0&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x5F00;&#x4E00;&#x4E2A; $vis$ &#x6570;&#x7EC4;&#xFF0C;&#x6BCF;&#x6B21;&#x626B;&#x5230;&#x70B9; x&#xFF0C;&#x5C31;&#x628A; $vis_x$ &#x5F02;&#x6216;&#x4E0A; 1&#x3002;</p>
<p>&#x5982;&#x679C; $vis_x=0$ &#xFF0C;&#x90A3;&#x8FD9;&#x4E2A;&#x70B9;&#x7684;&#x8D21;&#x732E;&#x5C31;&#x53EF;&#x4EE5;&#x4E0D;&#x8BA1;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x7528;&#x6811;&#x4E0A;&#x83AB;&#x961F;&#x6765;&#x6C42;&#x3002;</p>
<p>&#x4FEE;&#x6539;&#x7684;&#x8BDD;&#xFF0C;&#x52A0;&#x4E0A;&#x4E00;&#x7EF4;&#x65F6;&#x95F4;&#x7EF4;&#x5373;&#x53EF;&#xFF0C;&#x53D8;&#x6210;&#x5E26;&#x4FEE;&#x6539;&#x6811;&#x4E0A;&#x83AB;&#x961F;&#x3002;</p>
<p>&#x7136;&#x540E;&#x56E0;&#x4E3A;&#x6240;&#x5305;&#x542B;&#x7684;&#x533A;&#x95F4;&#x5185;&#x53EF;&#x80FD;&#x6CA1;&#x6709; LCA&#xFF0C;&#x5BF9;&#x4E8E;&#x6CA1;&#x6709;&#x7684;&#x60C5;&#x51B5;&#x8981;&#x5C06;&#x591A;&#x4F59;&#x7684;&#x8D21;&#x732E;&#x5220;&#x9664;&#xFF0C;&#x7136;&#x540E;&#x5C31;&#x5B8C;&#x4E8B;&#x4E86;&#x3002;</p>
<p>??? &#x53C2;&#x8003;&#x4EE3;&#x7801;</p>
<pre><code>```cpp
#include &lt;algorithm&gt;
#include &lt;cmath&gt;
#include &lt;cstdio&gt;
#include &lt;iostream&gt;

#define DEBUG printf(&quot;line:%d func:%s\n&quot;, __LINE__, __FUNCTION__);

using namespace std;

const int maxn = 200010;

int f[maxn], g[maxn], id[maxn], head[maxn], cnt, last[maxn], dep[maxn],
    fa[maxn][22], v[maxn], w[maxn];
int block, index, n, m, q;
int pos[maxn], col[maxn], app[maxn];
bool vis[maxn];
long long ans[maxn], cur;

struct edge {
  int to, nxt;
} e[maxn];
int cnt1 = 0, cnt2 = 0;  // &#x65F6;&#x95F4;&#x6233;

struct query {
  int l, r, t, id;
  bool operator&lt;(const query &amp;b) const {
    return (pos[l] &lt; pos[b.l]) || (pos[l] == pos[b.l] &amp;&amp; pos[r] &lt; pos[b.r]) ||
           (pos[l] == pos[b.l] &amp;&amp; pos[r] == pos[b.r] &amp;&amp; t &lt; b.t);
  }
} a[maxn], b[maxn];

inline void addedge(int x, int y) {
  e[++cnt] = (edge){y, head[x]};
  head[x] = cnt;
}

void dfs(int x) {
  id[f[x] = ++index] = x;
  for (int i = head[x]; i; i = e[i].nxt) {
    if (e[i].to != fa[x][0]) {
      fa[e[i].to][0] = x;
      dep[e[i].to] = dep[x] + 1;
      dfs(e[i].to);
    }
  }
  id[g[x] = ++index] = x;  // &#x62EC;&#x53F7;&#x5E8F;
}

inline void swap(int &amp;x, int &amp;y) {
  int t;
  t = x;
  x = y;
  y = t;
}

inline int lca(int x, int y) {
  if (dep[x] &lt; dep[y]) swap(x, y);
  if (dep[x] != dep[y]) {
    int dis = dep[x] - dep[y];
    for (int i = 20; i &gt;= 0; i--)
      if (dis &gt;= (1 &lt;&lt; i)) dis -= 1 &lt;&lt; i, x = fa[x][i];
  }  // &#x722C;&#x5230;&#x540C;&#x4E00;&#x9AD8;&#x5EA6;
  if (x == y) return x;
  for (int i = 20; i &gt;= 0; i--) {
    if (fa[x][i] != fa[y][i]) x = fa[x][i], y = fa[y][i];
  }
  return fa[x][0];
}

inline void add(int x) {
  if (vis[x])
    cur -= (long long)v[col[x]] * w[app[col[x]]--];
  else
    cur += (long long)v[col[x]] * w[++app[col[x]]];
  vis[x] ^= 1;
}

inline void modify(int x, int t) {
  if (vis[x]) {
    add(x);
    col[x] = t;
    add(x);
  } else
    col[x] = t;
}  // &#x5728;&#x65F6;&#x95F4;&#x7EF4;&#x4E0A;&#x79FB;&#x52A8;

int main() {
  scanf(&quot;%d%d%d&quot;, &amp;n, &amp;m, &amp;q);
  for (int i = 1; i &lt;= m; i++) scanf(&quot;%d&quot;, &amp;v[i]);
  for (int i = 1; i &lt;= n; i++) scanf(&quot;%d&quot;, &amp;w[i]);
  for (int i = 1; i &lt; n; i++) {
    int x, y;
    scanf(&quot;%d%d&quot;, &amp;x, &amp;y);
    addedge(x, y);
    addedge(y, x);
  }
  for (int i = 1; i &lt;= n; i++) {
    scanf(&quot;%d&quot;, &amp;last[i]);
    col[i] = last[i];
  }
  dfs(1);
  for (int j = 1; j &lt;= 20; j++)
    for (int i = 1; i &lt;= n; i++)
      fa[i][j] = fa[fa[i][j - 1]][j - 1];  // &#x9884;&#x5904;&#x7406;&#x7956;&#x5148;
  int block = pow(index, 2.0 / 3);
  for (int i = 1; i &lt;= index; i++) {
    pos[i] = (i - 1) / block;
  }
  while (q--) {
    int opt, x, y;
    scanf(&quot;%d%d%d&quot;, &amp;opt, &amp;x, &amp;y);
    if (opt == 0) {
      b[++cnt2].l = x;
      b[cnt2].r = last[x];
      last[x] = b[cnt2].t = y;
    } else {
      if (f[x] &gt; f[y]) swap(x, y);
      a[++cnt1] = (query){lca(x, y) == x ? f[x] : g[x], f[y], cnt2, cnt1};
    }
  }
  sort(a + 1, a + cnt1 + 1);
  int L, R, T;  // &#x6307;&#x9488;&#x5750;&#x6807;
  L = R = 0;
  T = 1;
  for (int i = 1; i &lt;= cnt1; i++) {
    while (T &lt;= a[i].t) {
      modify(b[T].l, b[T].t);
      T++;
    }
    while (T &gt; a[i].t) {
      modify(b[T].l, b[T].r);
      T--;
    }
    while (L &gt; a[i].l) {
      L--;
      add(id[L]);
    }
    while (L &lt; a[i].l) {
      add(id[L]);
      L++;
    }
    while (R &gt; a[i].r) {
      add(id[R]);
      R--;
    }
    while (R &lt; a[i].r) {
      R++;
      add(id[R]);
    }
    int x = id[L], y = id[R];
    int llca = lca(x, y);
    if (x != llca &amp;&amp; y != llca) {
      add(llca);
      ans[a[i].id] = cur;
      add(llca);
    } else
      ans[a[i].id] = cur;
  }
  for (int i = 1; i &lt;= cnt1; i++) {
    printf(&quot;%lld\n&quot;, ans[i]);
  }
  return 0;
}
```
</code></pre><h2 id="&#x771F;&#xB7;&#x6811;&#x4E0A;&#x83AB;&#x961F;">&#x771F;&#xB7;&#x6811;&#x4E0A;&#x83AB;&#x961F;</h2>
<p>&#x4E0A;&#x9762;&#x7684;&#x6811;&#x4E0A;&#x83AB;&#x961F;&#x53EA;&#x662F;&#x5C06;&#x6811;&#x8F6C;&#x5316;&#x6210;&#x4E86;&#x94FE;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x624D;&#x662F;&#x771F;&#x6B63;&#x7684;&#x6811;&#x4E0A;&#x83AB;&#x961F;&#x3002;</p>
<p>&#x7531;&#x4E8E;&#x83AB;&#x961F;&#x76F8;&#x5173;&#x7684;&#x95EE;&#x9898;&#x90FD;&#x662F;&#x6A21;&#x677F;&#x9898;&#xFF0C;&#x56E0;&#x6B64;&#x5B9E;&#x73B0;&#x90E8;&#x5206;&#x4E0D;&#x505A;&#x592A;&#x591A;&#x89E3;&#x91CA;</p>
<h3 id="&#x8BE2;&#x95EE;&#x7684;&#x6392;&#x5E8F;">&#x8BE2;&#x95EE;&#x7684;&#x6392;&#x5E8F;</h3>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x83AB;&#x961F;&#x7684;&#x662F;&#x57FA;&#x4E8E;&#x5206;&#x5757;&#x7684;&#x7B97;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x627E;&#x5230;&#x4E00;&#x79CD;&#x6811;&#x4E0A;&#x7684;&#x5206;&#x5757;&#x65B9;&#x6CD5;&#x6765;&#x4FDD;&#x8BC1;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x3002;</p>
<p>&#x6761;&#x4EF6;&#xFF1A;</p>
<ul>
<li>&#x5C5E;&#x4E8E;&#x540C;&#x4E00;&#x5757;&#x7684;&#x8282;&#x70B9;&#x4E4B;&#x95F4;&#x7684;&#x8DDD;&#x79BB;&#x4E0D;&#x8D85;&#x8FC7;&#x7ED9;&#x5B9A;&#x5757;&#x7684;&#x5927;&#x5C0F;</li>
<li>&#x6BCF;&#x4E2A;&#x5757;&#x4E2D;&#x7684;&#x8282;&#x70B9;&#x4E0D;&#x80FD;&#x592A;&#x591A;&#x4E5F;&#x4E0D;&#x80FD;&#x592A;&#x5C11;</li>
<li>&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x5C5E;&#x4E8E;&#x4E00;&#x4E2A;&#x5757;</li>
<li>&#x7F16;&#x53F7;&#x76F8;&#x90BB;&#x7684;&#x5757;&#x4E4B;&#x95F4;&#x7684;&#x8DDD;&#x79BB;&#x4E0D;&#x80FD;&#x592A;&#x5927;</li>
</ul>
<p>&#x4E86;&#x89E3;&#x4E86;&#x8FD9;&#x4E9B;&#x6761;&#x4EF6;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x8FD9;&#x6837;&#x4E00;&#x9053;&#x9898; <a href="https://loj.ac/problem/2152" target="_blank">&#x300C;SCOI2005&#x300D;&#x738B;&#x5BA4;&#x8054;&#x90A6;</a> &#x3002;</p>
<p>&#x5728;&#x8FD9;&#x9053;&#x9898;&#x7684;&#x57FA;&#x7840;&#x4E0A;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x4FDD;&#x8BC1;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x6761;&#x4EF6;&#x5C31;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x5206;&#x5757;&#x7684;&#x95EE;&#x9898;&#x4E86;&#x3002;</p>
<p>!!! &#x601D;&#x8DEF;
    &#x4EE4; lim &#x4E3A;&#x5E0C;&#x671B;&#x5757;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x9996;&#x5148;&#xFF0C;&#x5BF9;&#x4E8E;&#x6574;&#x4E2A;&#x6811; dfs&#xFF0C;&#x5F53;&#x5B50;&#x6811;&#x7684;&#x5927;&#x5C0F;&#x5927;&#x4E8E; lim &#x65F6;&#xFF0C;&#x5C31;&#x5C06;&#x5B83;&#x4EEC;&#x5206;&#x5728;&#x4E00;&#x5757;&#xFF0C;&#x5BB9;&#x6613;&#x60F3;&#x5230;&#xFF1A;&#x5BF9;&#x4E8E;&#x6839;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5269;&#x4E0B;&#x4E00;&#x4E9B;&#x70B9;&#xFF0C;&#x4E8E;&#x662F;&#x5C06;&#x8FD9;&#x4E9B;&#x70B9;&#x5206;&#x5728;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5757;&#x91CC;&#x3002;</p>
<p>&#x505A;&#x6CD5;&#xFF1A;&#x7528;&#x6808;&#x7EF4;&#x62A4;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x4F5C;&#x4E3A;&#x7236;&#x8282;&#x70B9;&#x8BBF;&#x95EE;&#x5B83;&#x7684;&#x5B50;&#x8282;&#x70B9;&#xFF0C;&#x5F53;&#x4ECE;&#x6808;&#x9876;&#x5230;&#x7236;&#x8282;&#x70B9;&#x7684;&#x8DDD;&#x79BB;&#x5927;&#x4E8E;&#x5E0C;&#x671B;&#x5757;&#x7684;&#x5927;&#x5C0F;&#x65F6;&#xFF0C;&#x5F39;&#x51FA;&#x8FD9;&#x90E8;&#x5206;&#x5143;&#x7D20;&#x5206;&#x4E3A;&#x4E00;&#x5757;&#xFF0C;&#x6700;&#x540E;&#x5269;&#x4F59;&#x7684;&#x4E00;&#x5757;&#x5355;&#x72EC;&#x4F5C;&#x4E3A;&#x4E00;&#x5757;&#x3002;</p>
<p>&#x6700;&#x540E;&#x7684;&#x6392;&#x5E8F;&#x65B9;&#x6CD5;&#xFF1A;&#x82E5;&#x7B2C;&#x4E00;&#x7EF4;&#x65F6;&#x95F4;&#x6233;&#x5927;&#x4E8E;&#x7B2C;&#x4E8C;&#x7EF4;&#xFF0C;&#x4EA4;&#x6362;&#x5B83;&#x4EEC;&#xFF0C;&#x6309;&#x7B2C;&#x4E00;&#x7EF4;&#x6240;&#x5C5E;&#x5757;&#x4E3A;&#x7B2C;&#x4E00;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x7B2C;&#x4E8C;&#x7EF4;&#x65F6;&#x95F4;&#x6233;&#x4E3A;&#x7B2C;&#x4E8C;&#x5173;&#x952E;&#x5B57;&#x6392;&#x5E8F;&#x3002;</p>
<h3 id="&#x6307;&#x9488;&#x7684;&#x79FB;&#x52A8;">&#x6307;&#x9488;&#x7684;&#x79FB;&#x52A8;</h3>
<p>&#x5BB9;&#x6613;&#x60F3;&#x5230;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6807;&#x8BB0;&#x88AB;&#x8BA1;&#x5165;&#x7B54;&#x6848;&#x7684;&#x70B9;&#xFF0C;&#x8BA9;&#x6307;&#x9488;&#x76F4;&#x63A5;&#x5411;&#x76EE;&#x6807;&#x79FB;&#x52A8;&#xFF0C;&#x540C;&#x65F6;&#x53D6;&#x53CD;&#x8DEF;&#x5F84;&#x4E0A;&#x7684;&#x70B9;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x6837;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x82E5;&#x6307;&#x9488;&#x4E00;&#x5F00;&#x59CB;&#x90FD;&#x5728; x &#x4E0A;&#xFF0C;&#x663E;&#x7136; x &#x88AB;&#x6807;&#x8BB0;&#xFF0C;&#x5F53;&#x4E24;&#x4E2A;&#x6307;&#x9488;&#x5411;&#x540C;&#x4E00;&#x5B50;&#x8282;&#x70B9;&#x79FB;&#x52A8;&#xFF08;&#x8FD8;&#x6709;&#x8BB8;&#x591A;&#x60C5;&#x51B5;&#xFF09;&#x65F6;&#xFF0C;x &#x5E94;&#x8BE5;&#x4E0D;&#x88AB;&#x6807;&#x8BB0;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x662F; x &#x88AB;&#x6807;&#x8BB0;&#xFF0C;&#x56E0;&#x4E3A;&#x4E24;&#x4E2A;&#x6307;&#x9488;&#x5206;&#x522B;&#x6807;&#x8BB0;&#x4E86;&#x4E00;&#x6B21;&#xFF0C;&#x62B5;&#x6D88;&#x4E86;&#x3002;</p>
<p>&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x5462;&#xFF1F;</p>
<p>&#x6709;&#x4E00;&#x4E2A;&#x5F88;&#x663E;&#x7136;&#x7684;&#x6027;&#x8D28;&#xFF1A;&#x8FD9;&#x4E9B;&#x70B9;&#x80AF;&#x5B9A;&#x662F;&#x67D0;&#x4E9B; LCA&#xFF0C;&#x56E0;&#x4E3A; LCA &#x5904;&#x624D;&#x6709;&#x53EF;&#x80FD;&#x88AB;&#x91CD;&#x590D;&#x64A4;&#x9500;&#x5BFC;&#x81F4;&#x64A4;&#x9500;&#x5931;&#x8D25;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x6BCF;&#x6B21;&#x4E0D;&#x6807;&#x8BB0; LCA&#xFF0C;&#x5230;&#x9700;&#x8981;&#x8BE2;&#x95EE;&#x7B54;&#x6848;&#x65F6;&#x518D;&#x5C06; LCA &#x6807;&#x8BB0;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x64A4;&#x9500;&#x3002;</p>
<pre><code class="lang-cpp"><span class="hljs-comment">//&#x53D6;&#x53CD;&#x8DEF;&#x5F84;&#x4E0A;&#x9664;LCA&#x4EE5;&#x5916;&#x7684;&#x6240;&#x6709;&#x8282;&#x70B9;</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">move</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>{
  <span class="hljs-keyword">if</span> (dp[x] &lt; dp[y]) swap(x, y);
  <span class="hljs-keyword">while</span> (dp[x] &gt; dp[y]) update(x), x = fa[x];
  <span class="hljs-keyword">while</span> (x != y) update(x), update(y), x = fa[x], y = fa[y];
  <span class="hljs-comment">// x!=y&#x4FDD;&#x8BC1;LCA&#x6CA1;&#x88AB;&#x53D6;&#x53CD;</span>
}
</code></pre>
<p>&#x5BF9;&#x4E8E;&#x6C42; LCA&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528;&#x6811;&#x5256;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x628A;&#x5206;&#x5757;&#x7684;&#x6B65;&#x9AA4;&#x653E;&#x5230;&#x6811;&#x5256;&#x7684;&#x7B2C;&#x4E00;&#x6B21; dfs &#x91CC;&#x9762;&#xFF0C;&#x65F6;&#x95F4;&#x6233;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;&#x7B2C;&#x4E8C;&#x6B21; dfs &#x7684; dfs &#x5E8F;&#x3002;</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">int</span> bl[<span class="hljs-number">100002</span>], bls = <span class="hljs-number">0</span>;  <span class="hljs-comment">//&#x5C5E;&#x4E8E;&#x7684;&#x5757;&#xFF0C;&#x5757;&#x7684;&#x6570;&#x91CF;</span>
<span class="hljs-keyword">unsigned</span> step;            <span class="hljs-comment">//&#x5757;&#x5927;&#x5C0F;</span>
<span class="hljs-keyword">int</span> fa[<span class="hljs-number">100002</span>], dp[<span class="hljs-number">100002</span>], hs[<span class="hljs-number">100002</span>] = {<span class="hljs-number">0</span>}, sz[<span class="hljs-number">100002</span>] = {<span class="hljs-number">0</span>};
<span class="hljs-comment">//&#x7236;&#x8282;&#x70B9;&#xFF0C;&#x6DF1;&#x5EA6;&#xFF0C;&#x91CD;&#x513F;&#x5B50;&#xFF0C;&#x5927;&#x5C0F;</span>
<span class="hljs-built_in">stack</span>&lt;<span class="hljs-keyword">int</span>&gt; sta;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs1</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>{
  sz[x] = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">unsigned</span> ss = sta.size();
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[x]; i; i = nxt[i])
    <span class="hljs-keyword">if</span> (ver[i] != fa[x]) {
      fa[ver[i]] = x;
      dp[ver[i]] = dp[x] + <span class="hljs-number">1</span>;
      dfs1(ver[i]);
      sz[x] += sz[ver[i]];
      <span class="hljs-keyword">if</span> (sz[ver[i]] &gt; sz[hs[x]]) hs[x] = ver[i];
      <span class="hljs-keyword">if</span> (sta.size() - ss &gt;= step) {
        bls++;
        <span class="hljs-keyword">while</span> (sta.size() != ss) bl[sta.top()] = bls, sta.pop();
      }
    }
  sta.push(x);
}
<span class="hljs-comment">// main</span>
<span class="hljs-keyword">if</span> (!sta.empty()) {
  bls++;  <span class="hljs-comment">//&#x8FD9;&#x4E00;&#x884C;&#x53EF;&#x5199;&#x53EF;&#x4E0D;&#x5199;</span>
  <span class="hljs-keyword">while</span> (!sta.empty()) bl[sta.top()] = bls, sta.pop();
}
</code></pre>
<h3 id="&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;">&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;</h3>
<p>&#x91CD;&#x70B9;&#x5230;&#x4E86;&#xFF0C;&#x8FD9;&#x91CC;&#x5173;&#x7CFB;&#x5230;&#x5757;&#x7684;&#x5927;&#x5C0F;&#x53D6;&#x503C;&#x3002;</p>
<p>&#x8BBE;&#x5757;&#x7684;&#x5927;&#x5C0F;&#x4E3A; $unit$ &#xFF1A;</p>
<ul>
<li>&#x5BF9;&#x4E8E; x &#x6307;&#x9488;&#xFF0C;&#x7531;&#x4E8E;&#x6BCF;&#x4E2A;&#x5757;&#x4E2D;&#x8282;&#x70B9;&#x7684;&#x8DDD;&#x79BB;&#x5728; $unit$ &#x5DE6;&#x53F3;&#xFF0C;&#x6BCF;&#x4E2A;&#x5757;&#x4E2D; x &#x6307;&#x9488;&#x79FB;&#x52A8; $unit^2$ &#x6B21;&#xFF08; $unit\times dis_max$ &#xFF09;&#xFF0C;&#x5171;&#x8BA1; $n\times unit$ &#xFF08; $unit^2 \times (n\div unit)$ &#xFF09;&#x6B21;&#xFF1B;</li>
<li>&#x5BF9;&#x4E8E; y &#x6307;&#x9488;&#xFF0C;&#x6BCF;&#x4E2A;&#x5757;&#x4E2D;&#x6700;&#x591A;&#x79FB;&#x52A8; $O(n)$ &#x6B21;&#xFF0C;&#x5171;&#x8BA1; $n^2\div unit$ &#xFF08; $n \times (n \div unit)$ &#xFF09;&#x6B21;&#x3002;</li>
</ul>
<p>&#x52A0;&#x8D77;&#x6765;&#x5927;&#x6982;&#x5728;&#x6839;&#x53F7;&#x5904;&#x53D6;&#x5F97;&#x6700;&#x5C0F;&#x503C;&#xFF08;&#x7531;&#x4E8E;&#x6811;&#x4E0A;&#x83AB;&#x961F;&#x5757;&#x7684;&#x5927;&#x5C0F;&#x4E0D;&#x56FA;&#x5B9A;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4E00;&#x5B9A;&#x8981;&#x4E25;&#x683C;&#x6309;&#x7167;&#xFF09;&#x3002;</p>
<h3 id="&#x4F8B;&#x9898;wc2013&#x7CD6;&#x679C;&#x516C;&#x56ED;">&#x4F8B;&#x9898;[WC2013]&#x7CD6;&#x679C;&#x516C;&#x56ED;</h3>
<p>&#x7531;&#x4E8E;&#x591A;&#x4E86;&#x65F6;&#x95F4;&#x7EF4;&#xFF0C;&#x5757;&#x7684;&#x5927;&#x5C0F;&#x53D6;&#x5230; 0.6 &#x7684;&#x6837;&#x5B50;&#x5C31;&#x5DEE;&#x4E0D;&#x591A;&#x4E86;&#x3002;</p>
<p>??? &#x53C2;&#x8003;&#x4EE3;&#x7801;</p>
<pre><code>```cpp
#include &lt;bits/stdc++.h&gt;
//#pragma GCC optimize(2)
using namespace std;
inline int gi() {
  register int x, c, op = 1;
  while (c = getchar(), c &lt; &apos;0&apos; || c &gt; &apos;9&apos;)
    if (c == &apos;-&apos;) op = -op;
  x = c ^ 48;
  while (c = getchar(), c &gt;= &apos;0&apos; &amp;&amp; c &lt;= &apos;9&apos;)
    x = (x &lt;&lt; 3) + (x &lt;&lt; 1) + (c ^ 48);
  return x * op;
}
int head[100002], nxt[200004], ver[200004], tot = 0;
void add(int x, int y) {
  ver[++tot] = y, nxt[tot] = head[x], head[x] = tot;
  ver[++tot] = x, nxt[tot] = head[y], head[y] = tot;
}
int bl[100002], bls = 0;
unsigned step;
int fa[100002], dp[100002], hs[100002] = {0}, sz[100002] = {0}, top[100002],
                            id[100002];
stack&lt;int&gt; sta;
void dfs1(int x) {
  sz[x] = 1;
  unsigned ss = sta.size();
  for (int i = head[x]; i; i = nxt[i])
    if (ver[i] != fa[x]) {
      fa[ver[i]] = x, dp[ver[i]] = dp[x] + 1;
      dfs1(ver[i]);
      sz[x] += sz[ver[i]];
      if (sz[ver[i]] &gt; sz[hs[x]]) hs[x] = ver[i];
      if (sta.size() - ss &gt;= step) {
        bls++;
        while (sta.size() != ss) bl[sta.top()] = bls, sta.pop();
      }
    }
  sta.push(x);
}
int cnt = 0;
void dfs2(int x, int hf) {
  top[x] = hf, id[x] = ++cnt;
  if (!hs[x]) return;
  dfs2(hs[x], hf);
  for (int i = head[x]; i; i = nxt[i])
    if (ver[i] != fa[x] &amp;&amp; ver[i] != hs[x]) dfs2(ver[i], ver[i]);
}
int lca(int x, int y) {
  while (top[x] != top[y]) {
    if (dp[top[x]] &lt; dp[top[y]]) swap(x, y);
    x = fa[top[x]];
  }
  return dp[x] &lt; dp[y] ? x : y;
}
struct qu {
  int x, y, t, id;
  bool operator&lt;(const qu a) const {
    return bl[x] == bl[a.x] ? (bl[y] == bl[a.y] ? t &lt; a.t : bl[y] &lt; bl[a.y])
                            : bl[x] &lt; bl[a.x];
  }
} q[100001];
int qs = 0;
struct ch {
  int x, y, b;
} upd[100001];
int ups = 0;
long long ans[100001];
int b[100001] = {0};
int a[100001];
long long w[100001];
long long v[100001];
long long now = 0;
bool vis[100001] = {0};
void back(int t) {
  if (vis[upd[t].x]) {
    now -= w[b[upd[t].y]--] * v[upd[t].y];
    now += w[++b[upd[t].b]] * v[upd[t].b];
  }
  a[upd[t].x] = upd[t].b;
}
void change(int t) {
  if (vis[upd[t].x]) {
    now -= w[b[upd[t].b]--] * v[upd[t].b];
    now += w[++b[upd[t].y]] * v[upd[t].y];
  }
  a[upd[t].x] = upd[t].y;
}
void update(int x) {
  if (vis[x])
    now -= w[b[a[x]]--] * v[a[x]];
  else
    now += w[++b[a[x]]] * v[a[x]];
  vis[x] ^= 1;
}
void move(int x, int y) {
  if (dp[x] &lt; dp[y]) swap(x, y);
  while (dp[x] &gt; dp[y]) update(x), x = fa[x];
  while (x != y) update(x), update(y), x = fa[x], y = fa[y];
}
int main() {
  int n = gi(), m = gi(), k = gi();
  step = (int)pow(n, 0.6);
  for (int i = 1; i &lt;= m; i++) v[i] = gi();
  for (int i = 1; i &lt;= n; i++) w[i] = gi();
  for (int i = 1; i &lt; n; i++) add(gi(), gi());
  for (int i = 1; i &lt;= n; i++) a[i] = gi();
  for (int i = 1; i &lt;= k; i++)
    if (gi())
      q[++qs].x = gi(), q[qs].y = gi(), q[qs].t = ups, q[qs].id = qs;
    else
      upd[++ups].x = gi(), upd[ups].y = gi();
  for (int i = 1; i &lt;= ups; i++) upd[i].b = a[upd[i].x], a[upd[i].x] = upd[i].y;
  for (int i = ups; i; i--) back(i);
  fa[1] = 1;
  dfs1(1), dfs2(1, 1);
  if (!sta.empty()) {
    bls++;
    while (!sta.empty()) bl[sta.top()] = bls, sta.pop();
  }
  for (int i = 1; i &lt;= n; i++)
    if (id[q[i].x] &gt; id[q[i].y]) swap(q[i].x, q[i].y);
  sort(q + 1, q + qs + 1);
  int x = 1, y = 1, t = 0;
  for (int i = 1; i &lt;= qs; i++) {
    if (x != q[i].x) move(x, q[i].x), x = q[i].x;
    if (y != q[i].y) move(y, q[i].y), y = q[i].y;
    int f = lca(x, y);
    update(f);
    while (t &lt; q[i].t) change(++t);
    while (t &gt; q[i].t) back(t--);
    ans[q[i].id] = now;
    update(f);
  }
  for (int i = 1; i &lt;= qs; i++) printf(&quot;%lld\n&quot;, ans[i]);
  return 0;
}
```
</code></pre><h2 id="&#x53C2;&#x8003;&#x8D44;&#x6599;">&#x53C2;&#x8003;&#x8D44;&#x6599;</h2>
<ul>
<li><a href="https://blog.sengxian.com/algorithms/mo-s-algorithm" target="_blank">&#x83AB;&#x961F;&#x7B97;&#x6CD5;&#x5B66;&#x4E60;&#x7B14;&#x8BB0; | Sengxian&apos;s Blog</a> </li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="parallel-binsearch.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 整体二分">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"莫队算法","level":"1.12.2.3","depth":3,"next":{"title":"[随机化]","level":"1.12.3","depth":2,"ref":"","articles":[{"title":"随机函数","level":"1.12.3.1","depth":3,"path":"docs/misc/random.md","ref":"docs/misc/random.md","articles":[]},{"title":"爬山算法","level":"1.12.3.2","depth":3,"path":"docs/misc/hill-climbing.md","ref":"docs/misc/hill-climbing.md","articles":[]},{"title":"模拟退火","level":"1.12.3.3","depth":3,"path":"docs/misc/simulated-annealing.md","ref":"docs/misc/simulated-annealing.md","articles":[]}]},"previous":{"title":"整体二分","level":"1.12.2.2","depth":3,"path":"docs/misc/parallel-binsearch.md","ref":"docs/misc/parallel-binsearch.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"docs/misc/mo-algo.md","mtime":"2019-10-11T02:45:52.898Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-10-11T09:55:09.799Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

